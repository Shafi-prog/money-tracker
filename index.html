<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
  <meta http-equiv="Pragma" content="no-cache"/>
  <meta http-equiv="Expires" content="0"/>
  <title>SJA Money Tracker v2.0</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Tajawal', sans-serif; background-color: #f3f4f6; }
    .glass-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
    [x-cloak] { display: none !important; }
  </style>
  <script>
    function appData() {
      return {
        page: 'dashboard',
        mobileMenu: false,
        loading: false,
        loadingStates: { settings: false, transactions: false, budgets: false, accounts: false },
        setupMode: false,
        setupStep: 1,
        configStatus: { hasSheet: false, hasTelegram: false, hasAI: false },
        setupData: { botToken: '', chatId: '', sheetId: '' },
        stats: { income: 0, expense: 0, balance: 0, savings: 0 },
        transactions: [],
        allTransactions: [],
        filteredTransactions: [],
        searchQuery: '',
        budgets: [],
        errorMessage: '',
        showAddModal: false,
        showEditTransactionModal: false,
        editingTransaction: null,
        newTransaction: { amount: '', merchant: '', category: 'ุฃุฎุฑู', type: 'expense' },
        categories: ['ุทุนุงู', 'ููู', 'ููุงุชูุฑ', 'ุชุณูู', 'ุณูู', 'ุชุฑููู', 'ุตุญุฉ', 'ุฃุฎุฑู'],
        userSettings: { user_name: '', user_email: '', enable_notifications: true, telegram_notifications: true, budget_alerts: true, default_currency: 'SAR', language: 'ar', salary_day: 1, auto_apply_rules: true },
        reportPeriod: 'monthly',
        reportData: null,
        accounts: [],
        showAccountModal: false,
        showAIExtraction: false,
        editingAccount: null,
        newAccount: { name: '', type: 'ุจูู', number: '', bank: '', aliases: '', isMine: true, isInternal: false, smsText: '' },
        showBudgetModal: false,
        editingBudget: null,
        newBudget: { category: '', limit: '' },
        showPrivacyModal: false,
        toasts: [],
        
        navigateToPage(pageName) {
          this.page = pageName;
          // Auto-load data when navigating to certain pages
          if (pageName === 'reports' && !this.reportData) {
            this.loadReport('monthly');
          }
        },
        
        init() {
          console.log('๐ SJA Money Tracker v2.0 - Initialized');
          console.log('โ Using optimized single API call');
          // Load settings first, then load data after settings complete
          this.loading = true;
          this.loadSettings();
        },
        
        loadSettings() {
          google.script.run
            .withSuccessHandler(result => {
              if (result && result.settings) {
                this.userSettings = result.settings;
                console.log('Settings loaded:', result.settings);
              }
              // After settings load, refresh data
              this.refreshData();
            })
            .withFailureHandler(err => {
              console.error('Error loading settings:', err);
              // Load data anyway even if settings fail
              this.refreshData();
            })
            .SOV1_UI_getSettings();
        },
        
        checkFirstTimeSetup() {
          this.loading = true;
          
          // Check if google.script.run is available
          if (typeof google === 'undefined' || !google.script) {
            console.error('Google Apps Script API not available');
            this.loading = false;
            this.errorMessage = 'ูุง ูููู ุงูุงุชุตุงู ุจุงูุฎุงุฏู. ุชุฃูุฏ ูู ูุดุฑ ุงูุชุทุจูู ุจุดูู ุตุญูุญ.';
            return;
          }
          
          google.script.run
            .withSuccessHandler(status => {
              this.configStatus = status;
              if (!status.hasSheet) {
                this.setupMode = true;
                this.loading = false;
                this.errorMessage = 'ูุฑุฌู ุฅุนุฏุงุฏ Google Sheets ุฃููุงู';
              } else {
                this.refreshData();
              }
            })
            .withFailureHandler(err => {
              console.error('Config check failed:', err);
              this.loading = false;
              this.errorMessage = 'ุชุญุฐูุฑ: ูุฏ ูููู ุงููุธุงู ุบูุฑ ูููุฃ ุจุงููุงูู';
              // Try to load data anyway
              this.refreshData();
            })
            .SOV1_UI_checkConfig();
        },

        refreshData() {
          this.loading = true;
          this.errorMessage = '';
          
          var timeoutId = null;
          var completed = false;
          
          // Extended timeout with better error message
          timeoutId = setTimeout(() => {
            if (!completed && this.loading) {
              this.loading = false;
              this.errorMessage = 'โฑ๏ธ ุงูุชูุช ูููุฉ ุงูุชุญููู (30 ุซุงููุฉ). ูุฏ ูููู ุงูุณุจุจ:\n' +
                '1. ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช ุจุทูุก\n' +
                '2. ูููุฉ ุจูุงูุงุช ูุจูุฑุฉ ูู ุงูุฌุฏุงูู\n' +
                '3. ุฎุทุฃ ูู Google Apps Script\n\n' +
                'ุฌุฑุจ: ุชุญุฏูุซ ุงูุตูุญุฉ ุฃู ุงูุชุญูู ูู Google Sheets';
              console.error('Timeout after 30 seconds');
            }
          }, 30000); // Increased to 30 seconds
          
          // Check if google.script.run is available
          if (typeof google === 'undefined' || !google.script) {
            completed = true;
            clearTimeout(timeoutId);
            this.loading = false;
            this.errorMessage = 'โ ุฎุทุฃ: ูุง ูููู ุงูุงุชุตุงู ุจู Google Apps Script\n' +
              'ุชุฃูุฏ ูู:\n' +
              '1. ุฃูู ุชุณุชุฎุฏู ุฑุงุจุท Web App ุงูููุดูุฑ\n' +
              '2. ูุฏูู ุฅุฐู ุงููุตูู ููููู\n' +
              '3. ุงูุชุทุจูู ููุดูุฑ ุจุดูู ุตุญูุญ';
            return;
          }
          
          console.log('๐ Loading dashboard data...');
          
          // โ OPTIMIZED: Single API call instead of 4 separate calls
          google.script.run
            .withSuccessHandler(data => {
              completed = true;
              clearTimeout(timeoutId);
              
              console.log('โ All dashboard data received:', data);
              
              // CRITICAL: Show debug log if available
              if (data && data.debugLog && Array.isArray(data.debugLog)) {
                console.log('๐ Debug Log from Backend:');
                data.debugLog.forEach(log => console.log('  ' + log));
              }
              
              // Check if response is null or undefined
              if (!data || data === null || typeof data === 'undefined') {
                this.loading = false;
                this.errorMessage = 'โ๏ธ ูู ูุชู ุงุณุชูุงู ุจูุงูุงุช ูู ุงูุฎุงุฏู.\n' +
                  'ุงูุฃุณุจุงุจ ุงููุญุชููุฉ:\n' +
                  '1. Google Sheets ุบูุฑ ููุฌูุฏ ุฃู ูุญุฐูู\n' +
                  '2. ูุง ุชููู ุตูุงุญูุงุช ุงููุตูู\n' +
                  '3. ุฎุทุฃ ูู Backend Script\n\n' +
                  'ุฌุฑุจ: ูุชุญ Google Sheets ูุจุงุดุฑุฉ ูุงูุชุญูู ูู ุงูุจูุงูุงุช';
                console.error('โ Response is null/undefined');
                return;
              }
              
              // Check for error in response
              if (data.error || data.success === false) {
                this.loading = false;
                
                // Build detailed error message
                var errorDetails = 'โ ุฎุทุฃ ูู ุงูุฎุงุฏู: ' + (data.error || 'ุฎุทุฃ ุบูุฑ ูุนุฑูู');
                
                // Add debug log to error message if available
                if (data.debugLog && Array.isArray(data.debugLog)) {
                  errorDetails += '\n\n๐ ุชูุงุตูู ุงูุชุดุฎูุต:\n' + data.debugLog.join('\n');
                }
                
                // Add error stack if available
                if (data.errorStack) {
                  errorDetails += '\n\n๐ Stack Trace:\n' + data.errorStack;
                }
                
                errorDetails += '\n\nูุฏ ูููู ุงูุณุจุจ:\n' +
                  '1. ุฃุฎุทุงุก ูู ุงูุฃููุงุฏ ุงูุจุฑูุฌูุฉ\n' +
                  '2. ูุดููุฉ ูู ุตูุงุญูุงุช Google Sheets\n' +
                  '3. ุจูุงูุงุช ุชุงููุฉ ูู ุงูุฌุฏุงูู';
                
                this.errorMessage = errorDetails;
                console.error('โ Backend error:', data);
                return;
              }
              
              // Load KPI stats
              if (data.dashboard && data.dashboard.kpi) {
                this.stats.income = data.dashboard.kpi.incomeM || 0;
                this.stats.expense = data.dashboard.kpi.spendM || 0;
                this.stats.balance = data.dashboard.kpi.netM || 0;
                this.stats.savings = data.dashboard.kpi.totalRemain || 0;
                console.log('โ KPI loaded:', this.stats);
              } else {
                console.warn('โ๏ธ No KPI data in response');
              }
              
              // Load transactions
              if (data.transactions && Array.isArray(data.transactions)) {
                this.allTransactions = data.transactions.map((tx, i) => ({
                  id: tx.row || i,
                  date: tx.date,
                  merchant: tx.merchant || 'ุบูุฑ ูุญุฏุฏ',
                  category: tx.category || tx.type || 'ุฃุฎุฑู',
                  amount: tx.amount || 0,
                  type: tx.type || ''
                }));
                this.transactions = this.allTransactions.slice(0, 10);
                console.log('โ Transactions loaded:', this.transactions.length);
              } else {
                console.warn('โ๏ธ No transactions in response');
                this.transactions = [];
                this.allTransactions = [];
              }
              
              // Load budgets
              if (data.budgets && Array.isArray(data.budgets)) {
                this.budgets = data.budgets;
                console.log('โ Budgets loaded:', this.budgets.length);
              } else {
                console.warn('โ๏ธ No budgets in response');
                this.budgets = [];
              }
              
              // Load accounts
              if (data.accounts && Array.isArray(data.accounts)) {
                this.accounts = data.accounts;
                console.log('โ Accounts loaded:', this.accounts.length);
              } else {
                this.accounts = [];
              }
              
              this.loading = false;
              console.log('โ Dashboard refresh complete');
            })
            .withFailureHandler(err => {
              completed = true;
              clearTimeout(timeoutId);
              
              console.error('โ Error loading data:', err);
              this.loading = false;
              
              var errorMsg = 'โ ูุดู ุชุญููู ุงูุจูุงูุงุช:\n';
              
              if (err && err.message) {
                errorMsg += err.message;
                
                // Add helpful hints based on error type
                if (err.message.includes('ุบูุฑ ูุตุฑุญ') || err.message.includes('unauthorized')) {
                  errorMsg += '\n\n๐ก ุงูุณุจุจ ุงููุญุชูู: ูุดููุฉ ูู ุตูุงุญูุงุช ุงููุตูู';
                } else if (err.message.includes('not found') || err.message.includes('ูู ูุชู ุงูุนุซูุฑ')) {
                  errorMsg += '\n\n๐ก ุงูุณุจุจ ุงููุญุชูู: ุงูุฌุฏุงูู ุงููุทููุจุฉ ุบูุฑ ููุฌูุฏุฉ';
                } else if (err.message.includes('timeout')) {
                  errorMsg += '\n\n๐ก ุงูุณุจุจ ุงููุญุชูู: ุงูุงุชุตุงู ุจุทูุก ุฃู ุงูุจูุงูุงุช ูุซูุฑุฉ';
                }
              } else {
                errorMsg += String(err);
              }
              
              errorMsg += '\n\n๐ง ุงูุญููู ุงูููุชุฑุญุฉ:\n' +
                '1. ุชุญุฏูุซ ุงูุตูุญุฉ (F5)\n' +
                '2. ูุชุญ Google Sheets ูุงูุชุญูู ูู ุงูุจูุงูุงุช\n' +
                '3. ุชุดุบูู testDashboardData() ูู Apps Script Editor';
              
              this.errorMessage = errorMsg;
            })
            .SOV1_UI_getAllDashboardData_safe('OPEN');
        },
        
        completeSetup() {
          this.loading = true;
          google.script.run
            .withSuccessHandler(result => {
              this.loading = false;
              if (result.success) {
                this.setupMode = false;
                this.refreshData();
                alert('โ ุชู ุฅุนุฏุงุฏ ุงููุธุงู ุจูุฌุงุญ!');
              } else {
                alert('โ ูุดู ุงูุฅุนุฏุงุฏ: ' + result.message);
              }
            })
            .withFailureHandler(err => {
              this.loading = false;
              alert('โ ุฎุทุฃ: ' + err.message);
            })
            .SOV1_UI_quickSetup(this.setupData);
        },
        
        skipSetup() {
          this.setupMode = false;
          this.refreshData();
        },
        
        getBudgetProgress(budget) {
          if (!budget.limit || budget.limit === 0) return 0;
          return Math.min(100, (budget.spent / budget.limit) * 100);
        },
        
        getBudgetColor(progress) {
          if (progress >= 100) return 'bg-red-500';
          if (progress >= 80) return 'bg-yellow-500';
          return 'bg-green-500';
        },

        formatMoney(amount) {
          return new Intl.NumberFormat('ar-SA', { style: 'currency', currency: 'SAR' }).format(amount || 0);
        },

        formatDate(dateStr) {
          if(!dateStr) return '';
          const d = new Date(dateStr);
          if (isNaN(d.getTime())) return dateStr; // Return as-is if invalid
          return d.toLocaleDateString('ar-SA', { month: 'short', day: 'numeric', hour: '2-digit', minute:'2-digit' });
        },
        
        getCategoryIcon(cat) {
            const map = { 
              'ุทุนุงู': '๐', 'ููู': '๐', 'ููุงุชูุฑ': '๐งพ', 'ุชุณูู': '๐๏ธ', 
              'ูุทุงุนู': '๐ญ', 'ุณูู': '๐', 'ุชุฑููู': '๐ฎ', 'ุตุญุฉ': '๐',
              'ุชุนููู': '๐', 'ุฑุงุชุจ': '๐ฐ', 'ุงุณุชุซูุงุฑ': '๐'
            };
            return map[cat] || '๐ธ';
        },

        showAllTransactions() {
          this.page = 'transactions';
          this.transactions = this.allTransactions;
        },
        
        openAddModal() {
          this.showAddModal = true;
          this.newTransaction = { amount: '', merchant: '', category: 'ุฃุฎุฑู', type: 'expense' };
        },
        
        deleteTransaction(tx) {
          if (!confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐู ุงูุนูููุฉุ\n' + tx.merchant + ' - ' + this.formatMoney(tx.amount))) {
            return;
          }
          
          this.loading = true;
          google.script.run
            .withSuccessHandler(result => {
              this.loading = false;
              alert('โ ุชู ุญุฐู ุงูุนูููุฉ ุจูุฌุงุญ');
              this.refreshData();
            })
            .withFailureHandler(err => {
              this.loading = false;
              this.errorMessage = 'ูุดู ุญุฐู ุงูุนูููุฉ: ' + (err.message || err);
              alert('โ ูุดู ุญุฐู ุงูุนูููุฉ: ' + (err.message || err));
            })
            .SOV1_UI_deleteTransaction(tx.id);
        },
        
        addTransaction() {
          // Validation
          if (!this.newTransaction.merchant || this.newTransaction.merchant.trim() === '') {
            this.showToast('ูุฑุฌู ุฅุฏุฎุงู ุงุณู ุงูุชุงุฌุฑ', 'error');
            return;
          }
          
          if (!this.isPositiveNumber(this.newTransaction.amount)) {
            this.showToast('ูุฑุฌู ุฅุฏุฎุงู ูุจูุบ ุตุญูุญ ุฃูุจุฑ ูู ุตูุฑ', 'error');
            return;
          }
          
          // Optimistic UI: Add to UI immediately
          const optimisticTx = {
            id: 'temp-' + Date.now(),
            date: new Date().toISOString(),
            merchant: this.newTransaction.merchant,
            category: this.newTransaction.category,
            amount: this.newTransaction.type === 'expense' ? this.newTransaction.amount : -this.newTransaction.amount,
            type: this.newTransaction.type
          };
          
          this.transactions.unshift(optimisticTx);
          this.allTransactions.unshift(optimisticTx);
          
          // Update stats optimistically
          if (this.newTransaction.type === 'expense') {
            this.stats.expense += parseFloat(this.newTransaction.amount);
          } else {
            this.stats.income += parseFloat(this.newTransaction.amount);
          }
          this.stats.balance = this.stats.income - this.stats.expense;
          
          // Close modal immediately for better UX
          this.showAddModal = false;
          
          const text = `ุฃุถู: ${this.newTransaction.type === 'income' ? '-' : ''}${this.newTransaction.amount} | ${this.newTransaction.merchant} | ${this.newTransaction.category}`;
          
          console.log('Adding transaction (optimistic):', text);
          
          // Backend sync (async)
          google.script.run
            .withSuccessHandler(result => {
              console.log('Transaction confirmed by backend:', result);
              // Refresh to get accurate data from server
              setTimeout(() => this.refreshData(), 1000);
            })
            .withFailureHandler(err => {
              // Rollback optimistic update on failure
              this.transactions = this.transactions.filter(t => t.id !== optimisticTx.id);
              this.allTransactions = this.allTransactions.filter(t => t.id !== optimisticTx.id);
              this.errorMessage = 'ูุดู ุฅุถุงูุฉ ุงูุนูููุฉ: ' + (err.message || err);
              alert('โ ูุดู ุฅุถุงูุฉ ุงูุนูููุฉ. ุณูุชู ุงูุชุญุฏูุซ.');
              this.refreshData();
            })
            .SOV1_UI_addManualTransaction(text);
        },
        
        saveSettings() {
          // Validation
          if (!this.userSettings.user_name || this.userSettings.user_name.trim() === '') {
            this.showToast('ูุฑุฌู ุฅุฏุฎุงู ุงูุงุณู', 'error');
            return;
          }
          
          if (this.userSettings.user_email && !this.isValidEmail(this.userSettings.user_email)) {
            this.showToast('ูุฑุฌู ุฅุฏุฎุงู ุจุฑูุฏ ุฅููุชุฑููู ุตุญูุญ', 'error');
            return;
          }
          
          this.loadingStates.settings = true;
          
          google.script.run
            .withSuccessHandler((result) => {
              this.loadingStates.settings = false;
              this.showToast('ุชู ุญูุธ ุงูุฅุนุฏุงุฏุงุช ุจูุฌุงุญ');
              // Refresh settings to update UI immediately
              this.loadSettings();
            })
            .withFailureHandler(err => {
              this.loadingStates.settings = false;
              this.showToast('ูุดู ุญูุธ ุงูุฅุนุฏุงุฏุงุช', 'error');
            })
            .SOV1_UI_saveSettings(this.userSettings);
        },
        
        loadReport(period) {
          this.reportPeriod = period;
          this.loading = true;
          
          google.script.run
            .withSuccessHandler(data => {
              this.loading = false;
              this.reportData = data;
              console.log('Report data loaded:', data);
            })
            .withFailureHandler(err => {
              this.loading = false;
              this.errorMessage = 'ูุดู ุชุญููู ุงูุชูุฑูุฑ: ' + (err.message || err);
              console.error('Error loading report:', err);
            })
            .SOV1_UI_getReportData('OPEN', period);
        },
        
        loadAccounts() {
          google.script.run
            .withSuccessHandler(data => {
              this.accounts = data || [];
              console.log('Accounts loaded:', data);
            })
            .withFailureHandler(err => {
              console.error('Error loading accounts:', err);
              this.accounts = [];
            })
            .SOV1_UI_getAccounts();
        },
        
        addOrEditBudget() {
          // Validation
          if (!this.newBudget.category || this.newBudget.category.trim() === '') {
            this.showToast('ูุฑุฌู ุฅุฏุฎุงู ุงุณู ุงูุชุตููู', 'error');
            return;
          }
          
          if (!this.isPositiveNumber(this.newBudget.limit)) {
            this.showToast('ูุฑุฌู ุฅุฏุฎุงู ูุจูุบ ุตุญูุญ ุฃูุจุฑ ูู ุตูุฑ', 'error');
            return;
          }
          
          this.loadingStates.budgets = true;
          
          if (this.editingBudget) {
            // Update
            google.script.run
              .withSuccessHandler(result => {
                this.loadingStates.budgets = false;
                this.showBudgetModal = false;
                this.showToast('ุชู ุชุญุฏูุซ ุงูููุฒุงููุฉ ุจูุฌุงุญ');
                this.refreshData();
              })
              .withFailureHandler(err => {
                this.loadingStates.budgets = false;
                this.showToast('ูุดู ุชุญุฏูุซ ุงูููุฒุงููุฉ', 'error');
              })
              .SOV1_UI_updateBudget(this.newBudget.category, parseFloat(this.newBudget.limit));
          } else {
            // Create
            google.script.run
              .withSuccessHandler(result => {
                this.loadingStates.budgets = false;
                this.showBudgetModal = false;
                this.showToast('ุชู ุญูุธ ุงูููุฒุงููุฉ ุจูุฌุงุญ');
                this.refreshData();
              })
              .withFailureHandler(err => {
                this.loadingStates.budgets = false;
                this.showToast('ูุดู ุญูุธ ุงูููุฒุงููุฉ', 'error');
              })
              .SOV1_UI_saveBudget(this.newBudget);
          }
        },
        
        deleteBudget(category) {
          if (!confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ููุฒุงููุฉ ' + category + 'ุ')) {
            return;
          }
          
          this.loadingStates.budgets = true;
          google.script.run
            .withSuccessHandler(result => {
              this.loadingStates.budgets = false;
              this.showToast('ุชู ุญุฐู ุงูููุฒุงููุฉ');
              this.refreshData();
            })
            .withFailureHandler(err => {
              this.loadingStates.budgets = false;
              this.showToast('ูุดู ุญุฐู ุงูููุฒุงููุฉ', 'error');
            })
            .SOV1_UI_deleteBudget(category);
        },
        
        saveSettings() {
          if (!this.userSettings.user_name) {
            alert('ูุฑุฌู ุฅุฏุฎุงู ุงูุงุณู');
            return;
          }
          
          this.loading = true;
          console.log('Saving settings:', this.userSettings);
          
          // Safety timeout
          const timeoutId = setTimeout(() => {
            this.loading = false;
            this.errorMessage = 'ุงูุชูุช ูููุฉ ุงูุญูุธ';
          }, 8000);
          
          google.script.run
            .withSuccessHandler((result) => {
              clearTimeout(timeoutId);
              this.loading = false;
              alert('โ ุชู ุญูุธ ุงูุฅุนุฏุงุฏุงุช ุจูุฌุงุญ');
              console.log('Settings saved:', result);
            })
            .withFailureHandler(err => {
              clearTimeout(timeoutId);
              this.loading = false;
              this.errorMessage = 'ูุดู ุญูุธ ุงูุฅุนุฏุงุฏุงุช: ' + (err.message || err);
              alert('โ ูุดู ุญูุธ ุงูุฅุนุฏุงุฏุงุช: ' + (err.message || err));
            })
            .SOV1_UI_saveSettings(this.userSettings);
        },
        
        openAccountModal() {
          this.editingAccount = null;
          this.newAccount = { name: '', type: 'ุจูู', number: '', bank: '', aliases: '', isMine: true, isInternal: false, smsText: '' };
          this.showAccountModal = true;
        },
        
        extractFromSMS() {
          if (!this.newAccount.smsText || this.newAccount.smsText.trim().length === 0) {
            alert('โ๏ธ ุงูุฑุฌุงุก ูุตู ูุต ุงูุฑุณุงูุฉ ุฃููุงู');
            return;
          }
          
          this.loading = true;
          
          google.script.run
            .withSuccessHandler(result => {
              this.loading = false;
              if (result.success && result.account) {
                // Auto-fill form with AI extracted data
                this.newAccount = { ...this.newAccount, ...result.account };
                alert('โ ุชู ุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช ูู ุงูุฑุณุงูุฉ!');
              } else {
                alert('โ ูุดู ุงูุงุณุชุฎุฑุงุฌ: ' + (result.error || 'ุฎุทุฃ ุบูุฑ ูุนุฑูู'));
              }
            })
            .withFailureHandler(err => {
              this.loading = false;
              alert('โ ุฎุทุฃ: ' + (err.message || err));
            })
            .SOV1_UI_extractAccountFromSMS(this.newAccount.smsText);
        },
        
        editAccount(account) {
          this.editingAccount = account;
          this.newAccount = { ...account };
          this.showAccountModal = true;
        },
        
        saveAccount() {
          if (!this.newAccount.name || !this.newAccount.type) {
            alert('ุงูุงุณู ูุงูููุน ูุทููุจุงู');
            return;
          }
          
          this.loading = true;
          
          if (this.editingAccount) {
            // Update
            google.script.run
              .withSuccessHandler(result => {
                this.loading = false;
                this.showAccountModal = false;
                alert('โ ุชู ุชุญุฏูุซ ุงูุญุณุงุจ');
                this.loadAccounts();
              })
              .withFailureHandler(err => {
                this.loading = false;
                alert('โ ูุดู ุงูุชุญุฏูุซ: ' + (err.message || err));
              })
              .SOV1_UI_updateAccount(this.editingAccount.id, this.newAccount);
          } else {
            // Add new
            google.script.run
              .withSuccessHandler(result => {
                this.loading = false;
                this.showAccountModal = false;
                alert('โ ุชู ุฅุถุงูุฉ ุงูุญุณุงุจ');
                this.loadAccounts();
              })
              .withFailureHandler(err => {
                this.loading = false;
                alert('โ ูุดู ุงูุฅุถุงูุฉ: ' + (err.message || err));
              })
              .SOV1_UI_addAccount(this.newAccount);
          }
        },
        
        deleteAccount(account) {
          if (!confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุงูุญุณุงุจ: ' + account.name + '?')) {
            return;
          }
          
          this.loading = true;
          google.script.run
            .withSuccessHandler(result => {
              this.loading = false;
              alert('โ ุชู ุญุฐู ุงูุญุณุงุจ');
              this.loadAccounts();
            })
            .withFailureHandler(err => {
              this.loading = false;
              alert('โ ูุดู ุงูุญุฐู');
            })
            .SOV1_UI_deleteAccount(account.id);
        },
        
        showToast(message, type = 'success') {
          const id = Date.now();
          this.toasts.push({ id, message, type });
          setTimeout(() => {
            this.toasts = this.toasts.filter(t => t.id !== id);
          }, 3000);
        },
        
        isValidEmail(email) {
          const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          return regex.test(email);
        },
        
        isPositiveNumber(value) {
          const num = parseFloat(value);
          return !isNaN(num) && num > 0;
        },
        
        exportData() {
          this.showToast('ุฌุงุฑู ุชุตุฏูุฑ ุงูุจูุงูุงุช...', 'info');
          google.script.run
            .withSuccessHandler(csv => {
              const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
              const link = document.createElement('a');
              const url = URL.createObjectURL(blob);
              link.setAttribute('href', url);
              link.setAttribute('download', 'transactions_' + new Date().toISOString().split('T')[0] + '.csv');
              link.style.visibility = 'hidden';
              document.body.appendChild(link);
              link.click();
              document.body.removeChild(link);
              this.showToast('ุชู ุชุตุฏูุฑ ุงูุจูุงูุงุช ุจูุฌุงุญ', 'success');
            })
            .withFailureHandler(err => {
              this.showToast('ูุดู ุชุตุฏูุฑ ุงูุจูุงูุงุช', 'error');
            })
            .SOV1_UI_exportData();
        },
        
        confirmDeleteAccount() {
          if (confirm('โ๏ธ ุชุญุฐูุฑ: ุณูุชู ุญุฐู ุฌููุน ุจูุงูุงุชู ุจุดูู ููุงุฆู. ูู ุฃูุช ูุชุฃูุฏุ\\n\\nุงูุชุจ \"ูุนู\" ููุชุฃููุฏ.')) {
            const confirmation = prompt('ุงูุชุจ \"ุญุฐู\" ููุชุฃููุฏ ุงูููุงุฆู:');
            if (confirmation === 'ุญุฐู') {
              this.deleteAccount();
            } else {
              this.showToast('ุชู ุฅูุบุงุก ุงูุญุฐู', 'info');
            }
          }
        },
        
        deleteAccount() {
          this.showToast('ุฌุงุฑู ุญุฐู ุงูุญุณุงุจ...', 'info');
          google.script.run
            .withSuccessHandler(result => {
              alert('โ ุชู ุญุฐู ุญุณุงุจู ุจูุฌุงุญ. ุณูุชู ุชุญุฏูุซ ุงูุตูุญุฉ.');
              window.location.reload();
            })
            .withFailureHandler(err => {
              this.showToast('ูุดู ุญุฐู ุงูุญุณุงุจ: ' + err.message, 'error');
            })
            .SOV1_UI_deleteAccount();
        },
        
        searchTransactions() {
          if (!this.searchQuery || this.searchQuery.trim() === '') {
            this.filteredTransactions = this.allTransactions;
          } else {
            const query = this.searchQuery.toLowerCase();
            this.filteredTransactions = this.allTransactions.filter(tx => 
              tx.merchant.toLowerCase().includes(query) ||
              tx.category.toLowerCase().includes(query) ||
              String(tx.amount).includes(query)
            );
          }
          this.transactions = this.filteredTransactions.slice(0, 50);
        },
        
        openEditBudgetModal(budget) {
          this.editingBudget = budget;
          this.newBudget = { category: budget.category, limit: budget.limit };
          this.showBudgetModal = true;
        },
        
        openEditTransactionModal(tx) {
          this.editingTransaction = tx;
          this.newTransaction = {
            rowId: tx.id + 2,
            merchant: tx.merchant,
            category: tx.category,
            amount: tx.amount,
            notes: tx.notes || ''
          };
          this.showEditTransactionModal = true;
        },
        
        saveEditedTransaction() {
          // Validation
          if (!this.newTransaction.merchant || this.newTransaction.merchant.trim() === '') {
            this.showToast('ูุฑุฌู ุฅุฏุฎุงู ุงุณู ุงูุชุงุฌุฑ', 'error');
            return;
          }
          
          if (!this.isPositiveNumber(this.newTransaction.amount)) {
            this.showToast('ูุฑุฌู ุฅุฏุฎุงู ูุจูุบ ุตุญูุญ ุฃูุจุฑ ูู ุตูุฑ', 'error');
            return;
          }
          
          if (!this.newTransaction.category || this.newTransaction.category.trim() === '') {
            this.showToast('ูุฑุฌู ุงุฎุชูุงุฑ ุงูุชุตููู', 'error');
            return;
          }
          
          this.loading = true;
          google.script.run
            .withSuccessHandler(result => {
              this.loading = false;
              this.showEditTransactionModal = false;
              this.showToast('ุชู ุชุญุฏูุซ ุงูุนูููุฉ ุจูุฌุงุญ');
              this.refreshData();
            })
            .withFailureHandler(err => {
              this.loading = false;
              this.showToast('ูุดู ุชุญุฏูุซ ุงูุนูููุฉ', 'error');
            })
            .SOV1_UI_updateTransaction(this.newTransaction.rowId, {
              merchant: this.newTransaction.merchant,
              category: this.newTransaction.category,
              amount: parseFloat(this.newTransaction.amount),
              notes: this.newTransaction.notes
            });
        }
      }
    }
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="text-gray-800" x-data="appData()" x-init="init()" x-cloak>
  
  <!-- Setup Wizard Overlay -->
  <div x-show="setupMode" class="fixed inset-0 bg-gradient-to-br from-blue-600 to-purple-700 z-50 flex items-center justify-center p-4" x-transition>
    <div class="bg-white rounded-3xl shadow-2xl max-w-2xl w-full p-8">
      <!-- Header -->
      <div class="text-center mb-8">
        <div class="text-6xl mb-4">๐ฐ</div>
        <h1 class="text-3xl font-extrabold text-gray-900 mb-2">ูุฑุญุจุงู ูู SJA Money Tracker</h1>
        <p class="text-gray-600">ุฏุนูุง ูุนุฏ ูุธุงูู ูู ุฏูุงุฆู!</p>
      </div>

      <!-- Error Alert -->
      <div x-show="errorMessage" class="mb-6 p-4 bg-red-50 border border-red-200 rounded-xl text-red-700 text-sm" x-transition>
        <strong>โ๏ธ ุฎุทุฃ:</strong> <span x-text="errorMessage"></span>
      </div>

      <!-- Setup Status -->
      <div class="space-y-4 mb-8">
        <div class="flex items-center gap-3 p-4 rounded-xl" :class="configStatus.hasSheet ? 'bg-green-50' : 'bg-gray-50'">
          <span x-show="configStatus.hasSheet" class="text-2xl">โ</span>
          <span x-show="!configStatus.hasSheet" class="text-2xl">โ๏ธ</span>
          <div class="flex-1">
            <div class="font-bold text-gray-900">Google Sheets</div>
            <div class="text-sm text-gray-600">ุชุฎุฒูู ุงูุจูุงูุงุช</div>
          </div>
          <span x-show="configStatus.hasSheet" class="text-xs text-green-600 font-bold">ุฌุงูุฒ</span>
          <span x-show="!configStatus.hasSheet" class="text-xs text-gray-500 font-bold">ูุทููุจ</span>
        </div>

        <div class="flex items-center gap-3 p-4 rounded-xl" :class="configStatus.hasTelegram ? 'bg-green-50' : 'bg-gray-50'">
          <span x-show="configStatus.hasTelegram" class="text-2xl">โ</span>
          <span x-show="!configStatus.hasTelegram" class="text-2xl">โ๏ธ</span>
          <div class="flex-1">
            <div class="font-bold text-gray-900">Telegram Bot</div>
            <div class="text-sm text-gray-600">ุงุณุชูุจุงู ุงูุฑุณุงุฆู</div>
          </div>
          <span x-show="configStatus.hasTelegram" class="text-xs text-green-600 font-bold">ูุชุตู</span>
          <span x-show="!configStatus.hasTelegram" class="text-xs text-gray-500 font-bold">ูุทููุจ</span>
        </div>

        <div class="flex items-center gap-3 p-4 rounded-xl" :class="configStatus.hasAI ? 'bg-green-50' : 'bg-yellow-50'">
          <span x-show="configStatus.hasAI" class="text-2xl">โ</span>
          <span x-show="!configStatus.hasAI" class="text-2xl">โน๏ธ</span>
          <div class="flex-1">
            <div class="font-bold text-gray-900">AI Classification</div>
            <div class="text-sm text-gray-600">ุชุตููู ุชููุงุฆู ูููุนุงููุงุช</div>
          </div>
          <span x-show="configStatus.hasAI" class="text-xs text-green-600 font-bold">ููุนูู</span>
          <span x-show="!configStatus.hasAI" class="text-xs text-yellow-600 font-bold">ุงุฎุชูุงุฑู</span>
        </div>
      </div>

      <!-- Quick Start Guide -->
      <div class="bg-blue-50 border border-blue-200 rounded-xl p-6 mb-6">
        <h3 class="font-bold text-blue-900 mb-3 flex items-center gap-2">
          <span>๐</span> ุฏููู ุงูุจุฏุก ุงูุณุฑูุน
        </h3>
        <ol class="space-y-2 text-sm text-blue-800">
          <li class="flex gap-2"><span class="font-bold">1.</span> ุงูุชุญ Google Sheets ูุงูุณุฎ ูุนุฑู ุงูููู (SHEET_ID)</li>
          <li class="flex gap-2"><span class="font-bold">2.</span> ุฃูุดุฆ ุจูุช ุชูููุฌุฑุงู ุนุจุฑ @BotFather</li>
          <li class="flex gap-2"><span class="font-bold">3.</span> ุงูุตู ุงูุจูุงูุงุช ูู Script Properties</li>
          <li class="flex gap-2"><span class="font-bold">4.</span> ุฃุฑุณู /start ููุจูุช ููุญุตูู ุนูู Chat ID</li>
        </ol>
      </div>

      <!-- Actions -->
      <div class="flex gap-3">
        <button @click="skipSetup()" class="flex-1 px-6 py-3 border-2 border-gray-300 rounded-xl font-bold text-gray-700 hover:bg-gray-50 transition">
          ุชุฎุทู ุงูุขู
        </button>
        <button @click="page='setup'; setupMode=false" class="flex-1 px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl font-bold hover:shadow-lg transition">
          ูุชุญ ุฏููู ุงูุฅุนุฏุงุฏ
        </button>
      </div>

      <div class="mt-4 text-center">
        <a href="https://github.com/your-repo/wiki/setup" target="_blank" class="text-sm text-blue-600 hover:underline">
          ๐ ุดุงูุฏ ุงูููุฏูู ุงูุชุนูููู
        </a>
      </div>
    </div>
  </div>
  
  <!-- Sidebar (Desktop) -->
  <div class="fixed inset-y-0 right-0 w-64 bg-white shadow-xl hidden lg:flex flex-col z-20">
    <div class="h-20 flex items-center justify-center border-b border-gray-100">
      <div class="text-2xl font-extrabold text-green-600 tracking-tight flex items-center gap-2">
        <span class="text-green-600 font-black">SJA</span>
      </div>
    </div>
    <nav class="flex-1 px-4 py-6 space-y-2">
      <a href="#" @click.prevent="page='dashboard'" :class="{'bg-green-50 text-green-700': page==='dashboard', 'text-gray-600 hover:bg-gray-50': page!=='dashboard'}" class="flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-colors">
        <span>๐</span> ููุญุฉ ุงูุชุญูู
      </a>
      <a href="#" @click.prevent="page='transactions'" :class="{'bg-green-50 text-green-700': page==='transactions', 'text-gray-600 hover:bg-gray-50': page!=='transactions'}" class="flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-colors">
        <span>๐</span> ุงูุนูููุงุช
      </a>
      <a href="#" @click.prevent="page='budgets'" :class="{'bg-green-50 text-green-700': page==='budgets', 'text-gray-600 hover:bg-gray-50': page!=='budgets'}" class="flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-colors">
        <span>๐</span> ุงูููุฒุงููุงุช
      </a>
      <a href="#" @click.prevent="page='reports'" :class="{'bg-green-50 text-green-700': page==='reports', 'text-gray-600 hover:bg-gray-50': page!=='reports'}" class="flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-colors">
        <span>๐</span> ุงูุชูุงุฑูุฑ
      </a>
      <a href="#" @click.prevent="page='accounts'" :class="{'bg-green-50 text-green-700': page==='accounts', 'text-gray-600 hover:bg-gray-50': page!=='accounts'}" class="flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-colors">
        <span>๐ฆ</span> ุงูุญุณุงุจุงุช
      </a>
      <a href="#" @click.prevent="page='settings'" :class="{'bg-green-50 text-green-700': page==='settings', 'text-gray-600 hover:bg-gray-50': page!=='settings'}" class="flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-colors">
        <span>โ๏ธ</span> ุงูุฅุนุฏุงุฏุงุช
      </a>
      <a href="#" @click.prevent="page='tests'" :class="{'bg-green-50 text-green-700': page==='tests', 'text-gray-600 hover:bg-gray-50': page!=='tests'}" class="flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-colors border-t pt-4 mt-4">
        <span>๐งช</span> ุงุฎุชุจุงุฑุงุช ุงููุทูุฑ
      </a>
    </nav>
    <div class="p-4 border-t border-gray-100">
      <div class="flex items-center gap-3 px-4 py-3">
        <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-green-700 font-bold" x-text="(userSettings.user_name || 'ูุณุชุฎุฏู')[0]"></div>
        <div>
          <div class="text-sm font-bold" x-text="userSettings.user_name || 'ูุณุชุฎุฏู'"></div>
          <div class="text-xs text-gray-500" x-text="userSettings.user_email || ''"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile Header -->
  <div class="lg:hidden fixed top-0 inset-x-0 h-16 bg-white shadow-sm z-20 flex items-center justify-between px-4">
    <div class="text-xl font-extrabold text-green-600">SJA</div>
    <button @click="mobileMenu = !mobileMenu" class="p-2 rounded-lg bg-gray-100 text-gray-600 focus:outline-none">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
    </button>
  </div>
  
  <!-- Mobile Menu Overlay -->
  <div x-show="mobileMenu" class="fixed inset-0 bg-black bg-opacity-50 z-30 lg:hidden" @click="mobileMenu = false" x-transition.opacity></div>
  <div x-show="mobileMenu" class="fixed inset-y-0 right-0 w-64 bg-white z-40 lg:hidden shadow-2xl flex flex-col" 
       x-transition:enter="transition ease-out duration-300" x-transition:enter-start="translate-x-full" x-transition:enter-end="translate-x-0"
       x-transition:leave="transition ease-in duration-200" x-transition:leave-start="translate-x-0" x-transition:leave-end="translate-x-full">
       <div class="h-16 flex items-center justify-between px-4 border-b">
         <span class="font-bold text-lg">ุงููุงุฆูุฉ</span>
         <button @click="mobileMenu = false" class="text-gray-500">&times;</button>
       </div>
       <nav class="flex-1 p-4 space-y-2">
         <!-- Mobile Links (same as desktop) -->
         <a href="#" @click="page='dashboard'; mobileMenu=false" :class="{'bg-green-50 text-green-700': page==='dashboard'}" class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-50 font-medium">
           <span>๐</span> ููุญุฉ ุงูุชุญูู
         </a>
         <a href="#" @click="page='transactions'; mobileMenu=false" :class="{'bg-green-50 text-green-700': page==='transactions'}" class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-50 font-medium">
           <span>๐</span> ุงูุนูููุงุช
         </a>
         <a href="#" @click="page='budgets'; mobileMenu=false" :class="{'bg-green-50 text-green-700': page==='budgets'}" class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-50 font-medium">
           <span>๐</span> ุงูููุฒุงููุงุช
         </a>
         <a href="#" @click="page='reports'; mobileMenu=false" :class="{'bg-green-50 text-green-700': page==='reports'}" class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-50 font-medium">
           <span>๐</span> ุงูุชูุงุฑูุฑ
         </a>
         <a href="#" @click="page='accounts'; mobileMenu=false" :class="{'bg-green-50 text-green-700': page==='accounts'}" class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-50 font-medium">
           <span>๐ฆ</span> ุงูุญุณุงุจุงุช
         </a>
         <a href="#" @click="page='settings'; mobileMenu=false" :class="{'bg-green-50 text-green-700': page==='settings'}" class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-50 font-medium">
           <span>โ๏ธ</span> ุงูุฅุนุฏุงุฏุงุช
         </a>
         <a href="#" @click="page='tests'; mobileMenu=false" :class="{'bg-green-50 text-green-700': page==='tests'}" class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-gray-50 font-medium border-t pt-3 mt-3">
           <span>๐งช</span> ุงุฎุชุจุงุฑุงุช ุงููุทูุฑ
         </a>
       </nav>
  </div>

  <!-- Main Content -->
  <main class="lg:mr-64 min-h-screen pt-20 lg:pt-8 px-4 lg:px-8 pb-8 transition-all duration-300">
    
    <!-- Global Loading Overlay -->
    <div x-show="loading" x-transition.opacity class="fixed inset-0 bg-white/80 backdrop-blur-sm z-50 flex items-center justify-center">
      <div class="text-center">
        <div class="w-16 h-16 border-4 border-green-200 border-t-green-600 rounded-full animate-spin mx-auto mb-4"></div>
        <p class="text-gray-600 font-medium">ุฌุงุฑู ุงูุชุญููู...</p>
      </div>
    </div>

    <!-- Error Message Banner -->
    <div x-show="errorMessage" x-transition class="fixed top-4 left-1/2 transform -translate-x-1/2 z-40 max-w-md w-full mx-4">
      <div class="bg-red-500 text-white px-6 py-4 rounded-lg shadow-lg flex items-start gap-3">
        <span class="text-2xl">โ๏ธ</span>
        <div class="flex-1">
          <div class="font-bold mb-1">ุฎุทุฃ ูู ุงูุชุญููู</div>
          <div class="text-sm" x-text="errorMessage"></div>
        </div>
        <button @click="errorMessage = ''" class="text-white/80 hover:text-white">&times;</button>
      </div>
    </div>

    <!-- PAGE: DASHBOARD -->
    <div x-show="page === 'dashboard'" x-transition.opacity>
      <header class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
        <div>
          <h1 class="text-2xl font-bold text-gray-900">ูุธุฑุฉ ุนุงูุฉ</h1>
          <p class="text-gray-500 text-sm mt-1">ุฃููุงู ุจูุ ุฅููู ููุฎุตู ุงููุงูู ููุฐุง ุงูุดูุฑ.</p>
        </div>
        <div class="flex gap-2">
           <button @click="refreshData()" class="px-4 py-2 bg-white border border-gray-200 rounded-lg text-sm font-medium hover:bg-gray-50 transition shadow-sm flex items-center gap-2">
             <span x-show="loading" class="animate-spin">โป</span>
             <span>ุชุญุฏูุซ</span>
           </button>
           <button @click="openAddModal()" class="px-4 py-2 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700 transition shadow-lg shadow-green-200">
             + ุนูููุฉ ุฌุฏูุฏุฉ
           </button>
        </div>
      </header>

      <!-- KPI Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <!-- Balance Card -->
        <div class="bg-gradient-to-br from-indigo-500 to-blue-600 rounded-2xl p-6 text-white shadow-lg shadow-blue-100 relative overflow-hidden group hover:scale-[1.02] transition-transform">
          <div class="absolute top-0 right-0 w-32 h-32 bg-white opacity-10 rounded-full -mr-16 -mt-16 group-hover:scale-150 transition-transform duration-700"></div>
          <div class="text-blue-100 text-sm font-medium mb-1">ุงูุฑุตูุฏ ุงููุชููุฑ</div>
          <div class="text-3xl font-extrabold tracking-tight" x-text="formatMoney(stats.balance)">0.00</div>
          <div class="mt-4 flex items-center text-xs text-blue-100 bg-white/20 w-fit px-2 py-1 rounded-lg backdrop-blur-sm">
            <span>ูุฏุฎุฑุงุช ุชุฑุงูููุฉ</span>
          </div>
        </div>

        <!-- Income Card -->
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
          <div class="flex items-center justify-between mb-2">
            <div class="text-gray-500 text-sm font-medium">ุงูุฏุฎู ุงูุดูุฑู</div>
            <div class="w-8 h-8 rounded-full bg-green-50 flex items-center justify-center text-green-600">โ</div>
          </div>
          <div class="text-2xl font-bold text-gray-900" x-text="formatMoney(stats.income)">0.00</div>
          <div class="mt-2 text-xs text-green-600 font-medium">+12% ุนู ุงูุดูุฑ ุงููุงุถู</div>
        </div>

        <!-- Expense Card -->
        <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
           <div class="flex items-center justify-between mb-2">
            <div class="text-gray-500 text-sm font-medium">ุงููุตุฑููุงุช</div>
            <div class="w-8 h-8 rounded-full bg-red-50 flex items-center justify-center text-red-600">โ</div>
          </div>
          <div class="text-2xl font-bold text-gray-900" x-text="formatMoney(stats.expense)">0.00</div>
          <div class="mt-2 text-xs text-red-600 font-medium">ุถูู ุงูููุฒุงููุฉ ุงููุญุฏุฏุฉ</div>
        </div>

         <!-- Savings Card -->
         <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
           <div class="flex items-center justify-between mb-2">
            <div class="text-gray-500 text-sm font-medium">ุงูุชูููุฑ</div>
            <div class="w-8 h-8 rounded-full bg-purple-50 flex items-center justify-center text-purple-600">โ</div>
          </div>
          <div class="text-2xl font-bold text-gray-900" x-text="formatMoney(stats.savings)">0.00</div>
          <div class="mt-2 text-xs text-purple-600 font-medium">ููุชุงุฒ! ูุงุตู ุงูุชูุฏู.</div>
        </div>
      </div>

      <!-- Recent Transactions & Charts -->
      <div class="grid lg:grid-cols-3 gap-8">
        <!-- Recent Transactions List -->
        <div class="lg:col-span-2 bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
          <div class="px-6 py-4 border-b border-gray-50 flex items-center justify-between bg-gray-50/50">
            <h3 class="font-bold text-gray-800">ุขุฎุฑ ุงูุนูููุงุช</h3>
            <a href="#" @click.prevent="showAllTransactions()" class="text-xs text-green-600 font-semibold hover:underline">ุนุฑุถ ุงููู</a>
          </div>
          <div class="divide-y divide-gray-50">
             <!-- Loop Transactions -->
             <template x-for="tx in transactions.slice(0, 10)" :key="tx.id">
               <div class="flex items-center justify-between p-4 hover:bg-gray-50 transition-colors group cursor-pointer">
                 <div class="flex items-center gap-4">
                   <div class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-xl shadow-inner group-hover:scale-110 transition-transform">
                     <span x-text="getCategoryIcon(tx.category)">๐</span>
                   </div>
                   <div>
                     <div class="font-bold text-gray-900 text-sm" x-text="tx.merchant">Subway</div>
                     <div class="text-xs text-gray-500 mt-0.5" x-text="formatDate(tx.date)">Today, 10:23 AM</div>
                   </div>
                 </div>
                 <div class="text-right">
                   <div class="font-bold text-sm" :class="tx.amount > 0 ? 'text-red-500' : 'text-green-600'" x-text="formatMoney(Math.abs(tx.amount))">-25.00</div>
                   <div class="text-[10px] uppercase tracking-wider font-semibold text-gray-400 mt-0.5" x-text="tx.category">FOOD</div>
                 </div>
               </div>
             </template>
             <div x-show="transactions.length === 0" class="p-8 text-center">
               <div class="text-4xl mb-2">๐</div>
               <p class="text-gray-400 mb-3">ูุง ุชูุฌุฏ ุนูููุงุช ุญุฏูุซุฉ</p>
               <button @click="currentPage = 'transactions'" class="text-sm px-4 py-2 bg-green-500 text-white rounded-lg font-medium hover:bg-green-600 transition">
                 โ ุฅุถุงูุฉ ุนูููุฉ
               </button>
             </div>
          </div>
        </div>

        <!-- Mini Budget/Stats -->
        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
          <h3 class="font-bold text-gray-800 mb-6">ุชูุฒูุน ุงููุตุฑููุงุช</h3>
          
          <!-- Show message if no budgets -->
          <div x-show="budgets.length === 0" class="text-center py-8">
            <div class="text-4xl mb-3">๐</div>
            <p class="text-sm text-gray-400 mb-3">ูุง ุชูุฌุฏ ููุฒุงููุงุช ูุญุฏุฏุฉ</p>
            <button @click="currentPage = 'budgets'" class="text-sm px-4 py-2 bg-green-500 text-white rounded-lg font-medium hover:bg-green-600 transition">
              โ ุฅุถุงูุฉ ููุฒุงููุฉ
            </button>
          </div>
          
          <!-- Show top 3 budgets -->
          <template x-if="budgets.length > 0">
            <div class="space-y-4">
              <template x-for="(budget, idx) in budgets.slice(0, 3)" :key="idx">
                <div class="flex items-center justify-between text-sm">
                  <div class="flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full" 
                          :class="idx === 0 ? 'bg-green-500' : idx === 1 ? 'bg-blue-500' : 'bg-purple-500'"></span>
                    <span x-text="budget.category">ุงูุชุตููู</span>
                  </div>
                  <span class="font-bold" x-text="formatMoney(budget.spent)">0</span>
                </div>
              </template>
            </div>
          </template>
        </div>
      </div>
    </div>

    <!-- PAGE: TRANSACTIONS -->
    <div x-show="page === 'transactions'" x-transition.opacity>
      <header class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
        <div>
          <h1 class="text-2xl font-bold text-gray-900">ุงูุนูููุงุช ุงููุงููุฉ</h1>
          <p class="text-gray-500 text-sm mt-1">ุฌููุน ูุนุงููุงุชู ุงููุงููุฉ ูู ููุงู ูุงุญุฏ</p>
        </div>
        <button @click="refreshData()" class="px-4 py-2 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700 transition">
          ุชุญุฏูุซ ุงููุงุฆูุฉ
        </button>
      </header>
      
      <!-- Search Bar -->
      <div class="mb-6 bg-white rounded-xl shadow-sm border border-gray-100 p-4">
        <div class="flex gap-3">
          <div class="flex-1 relative">
            <input 
              type="text" 
              x-model="searchQuery"
              @input="searchTransactions()"
              placeholder="ุงุจุญุซ ูู ุงูุนูููุงุช... (ุงูุชุงุฌุฑุ ุงูุชุตูููุ ุงููุจูุบ)"
              class="w-full px-4 py-3 pr-12 border border-gray-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
            >
            <span class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 text-xl">๐</span>
          </div>
          <button 
            @click="searchQuery = ''; searchTransactions()"
            x-show="searchQuery"
            class="px-6 py-3 bg-gray-100 hover:bg-gray-200 rounded-lg transition font-medium text-gray-700"
          >
            ูุณุญ
          </button>
        </div>
        <div x-show="searchQuery" class="mt-2 text-sm text-gray-600">
          <span x-text="'ุนุฏุฏ ุงููุชุงุฆุฌ: ' + transactions.length"></span>
        </div>
      </div>

      <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead class="bg-gray-50 border-b border-gray-100">
              <tr>
                <th class="px-6 py-4 text-right text-xs font-bold text-gray-600 uppercase">ุงูุชุงุฑูุฎ</th>
                <th class="px-6 py-4 text-right text-xs font-bold text-gray-600 uppercase">ุงูุชุงุฌุฑ</th>
                <th class="px-6 py-4 text-right text-xs font-bold text-gray-600 uppercase">ุงูุชุตููู</th>
                <th class="px-6 py-4 text-right text-xs font-bold text-gray-600 uppercase">ุงููุจูุบ</th>
                <th class="px-6 py-4 text-center text-xs font-bold text-gray-600 uppercase">ุงูุฅุฌุฑุงุกุงุช</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-50">
              <template x-for="tx in transactions" :key="tx.id">
                <tr class="hover:bg-gray-50 transition-colors">
                  <td class="px-6 py-4 text-sm text-gray-600" x-text="formatDate(tx.date)"></td>
                  <td class="px-6 py-4">
                    <div class="flex items-center gap-3">
                      <span class="text-xl" x-text="getCategoryIcon(tx.category)"></span>
                      <span class="font-medium text-gray-900" x-text="tx.merchant"></span>
                    </div>
                  </td>
                  <td class="px-6 py-4">
                    <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium" x-text="tx.category"></span>
                  </td>
                  <td class="px-6 py-4">
                    <span class="font-bold" :class="tx.amount > 0 ? 'text-red-600' : 'text-green-600'" x-text="formatMoney(Math.abs(tx.amount))"></span>
                  </td>
                  <td class="px-6 py-4">
                    <div class="flex items-center justify-center gap-2">
                      <button @click="openEditTransactionModal(tx)" class="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition" title="ุชุนุฏูู">
                        โ๏ธ
                      </button>
                      <button @click="deleteTransaction(tx)" class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition" title="ุญุฐู">
                        ๐๏ธ
                      </button>
                    </div>
                  </td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
        <div x-show="transactions.length === 0" class="p-12 text-center">
          <div class="text-6xl mb-4">๐</div>
          <p class="text-gray-500 text-lg mb-6">ูุง ุชูุฌุฏ ุนูููุงุช ูุนุฑุถูุง</p>
          <button @click="showAddModal = true" class="px-6 py-3 bg-green-500 text-white rounded-xl font-bold hover:bg-green-600 transition shadow-lg">
            โ ุฅุถุงูุฉ ุฃูู ุนูููุฉ
          </button>
        </div>
      </div>
    </div>

    <!-- PAGE: BUDGETS -->
    <div x-show="page === 'budgets'" x-transition.opacity>
      <header class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
        <div>
          <h1 class="text-2xl font-bold text-gray-900">ุงูููุฒุงููุงุช</h1>
          <p class="text-gray-500 text-sm mt-1">ุชุชุจุน ูุตุฑููุงุชู ุญุณุจ ุงูุชุตููู</p>
        </div>
        <button @click="refreshData()" class="px-4 py-2 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700 transition">
          ุชุญุฏูุซ
        </button>
      </header>

      <!-- No budgets message -->
      <div x-show="budgets.length === 0" class="bg-white rounded-2xl shadow-sm border border-gray-100 p-12 text-center">
        <div class="text-6xl mb-4">๐</div>
        <h3 class="text-xl font-bold text-gray-900 mb-2">ูุง ุชูุฌุฏ ููุฒุงููุงุช</h3>
        <p class="text-gray-600 mb-6">ุงุจุฏุฃ ุจุฅุถุงูุฉ ููุฒุงููุงุช ูุชุชุจุน ูุตุฑููุงุชู ุญุณุจ ุงูุชุตููู</p>
        <button @click="showBudgetModal = true; editingBudget = null; newBudget = {category: '', limit: 0}" class="px-6 py-3 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 transition shadow-lg">
          โ ุฅุถุงูุฉ ุฃูู ููุฒุงููุฉ
        </button>
      </div>

      <!-- Budgets Grid -->
      <div x-show="budgets.length > 0" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        <template x-for="budget in budgets" :key="budget.category">
          <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition">
            <div class="flex items-center justify-between mb-4">
              <div class="flex items-center gap-3">
                <span class="text-3xl" x-text="getCategoryIcon(budget.category)">๐ธ</span>
                <div>
                  <h3 class="font-bold text-gray-900" x-text="budget.category">ุงูุชุตููู</h3>
                  <p class="text-xs text-gray-500">ุงูููุฒุงููุฉ ุงูุดูุฑูุฉ</p>
                </div>
              </div>
            </div>
            <div class="mb-2">
              <div class="flex justify-between text-sm mb-1">
                <span class="text-gray-600">ุงููุตุฑูู</span>
                <span class="font-bold text-gray-900">
                  <span x-text="formatMoney(budget.spent)">0</span> / 
                  <span x-text="formatMoney(budget.limit)">0</span>
                </span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-2">
                <div class="h-2 rounded-full transition-all" 
                     :class="getBudgetColor(getBudgetProgress(budget))"
                     :style="'width: ' + getBudgetProgress(budget) + '%'"></div>
              </div>
            </div>
            <p class="text-xs font-medium mt-3" 
               :class="getBudgetProgress(budget) >= 100 ? 'text-red-600' : getBudgetProgress(budget) >= 80 ? 'text-yellow-600' : 'text-green-600'">
              <template x-if="getBudgetProgress(budget) >= 100">
                <span>โ ุชุฌุงูุฒุช ุจู <span x-text="formatMoney(budget.spent - budget.limit)"></span></span>
              </template>
              <template x-if="getBudgetProgress(budget) < 100">
                <span>โ ุจุงูู <span x-text="formatMoney(budget.limit - budget.spent)"></span></span>
              </template>
            </p>
          </div>
        </template>
      </div>
    </div>

    <!-- PAGE: SETTINGS -->
    <div x-show="page === 'settings'" x-transition.opacity>
      <header class="mb-8">
        <h1 class="text-2xl font-bold text-gray-900">ุงูุฅุนุฏุงุฏุงุช</h1>
        <p class="text-gray-500 text-sm mt-1">ุชุฎุตูุต ุงููุธุงู ุญุณุจ ุงุญุชูุงุฌุงุชู</p>
      </header>

      <div class="space-y-6">
        <!-- Account Section -->
        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
          <h2 class="font-bold text-gray-900 mb-4 flex items-center gap-2">
            <span>๐ค</span> ุงูุญุณุงุจ ุงูุดุฎุตู
          </h2>
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">ุงูุงุณู</label>
              <input type="text" x-model="userSettings.user_name" class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
              <input type="email" x-model="userSettings.user_email" class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">ููู ูุฒูู ุงูุฑุงุชุจ</label>
              <input type="number" x-model="userSettings.salary_day" min="1" max="31" class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
              <p class="text-xs text-gray-500 mt-1">ูุณุชุฎุฏู ูุญุณุงุจ ุงูููุฒุงููุงุช ุงูุดูุฑูุฉ (ูู 1 ุฅูู 31)</p>
            </div>
            <div class="pt-4">
              <button @click="saveSettings()" class="w-full px-6 py-3 bg-green-600 text-white rounded-lg font-bold hover:bg-green-700 transition">
                ๐พ ุญูุธ ุงูุชุบููุฑุงุช
              </button>
            </div>
          </div>
        </div>

        <!-- Notifications Section -->
        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
          <h2 class="font-bold text-gray-900 mb-4 flex items-center gap-2">
            <span>๐</span> ุงูุฅุดุนุงุฑุงุช
          </h2>
          <div class="space-y-4">
            <div class="flex items-center justify-between">
              <div>
                <p class="font-medium text-gray-900">ุฅุดุนุงุฑุงุช ุชูููุฌุฑุงู</p>
                <p class="text-xs text-gray-500">ุงุณุชูุจุงู ุงูุชูุจููุงุช ุนุจุฑ ุจูุช ุชูููุฌุฑุงู</p>
              </div>
              <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" x-model="userSettings.telegram_notifications" @change="saveSettings()" class="sr-only peer">
                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content=[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
              </label>
            </div>
            <div class="flex items-center justify-between">
              <div>
                <p class="font-medium text-gray-900">ุชูุจููุงุช ุงูููุฒุงููุฉ</p>
                <p class="text-xs text-gray-500">ุฅุดุนุงุฑ ุนูุฏ ุชุฌุงูุฒ ุญุฏ ุงูููุฒุงููุฉ</p>
              </div>
              <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" x-model="userSettings.budget_alerts" @change="saveSettings()" class="sr-only peer">
                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
              </label>
            </div>
          </div>
        </div>

        <!-- System Section -->
        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
          <h2 class="font-bold text-gray-900 mb-4 flex items-center gap-2">
            <span>โ๏ธ</span> ุงููุธุงู
          </h2>
          <div class="space-y-3">
            <button @click="exportData()" class="w-full px-4 py-3 text-right border border-gray-200 rounded-lg hover:bg-gray-50 transition flex items-center justify-between">
              <span class="font-medium text-gray-900">ุชุตุฏูุฑ ุงูุจูุงูุงุช</span>
              <span class="text-gray-400">โ</span>
            </button>
            <button @click="showPrivacyModal = true" class="w-full px-4 py-3 text-right border border-gray-200 rounded-lg hover:bg-gray-50 transition flex items-center justify-between">
              <span class="font-medium text-gray-900">ุณูุงุณุฉ ุงูุฎุตูุตูุฉ</span>
              <span class="text-gray-400">โ</span>
            </button>
            <button @click="confirmDeleteAccount()" class="w-full px-4 py-3 text-right border border-red-200 rounded-lg hover:bg-red-50 transition flex items-center justify-between text-red-600">
              <span class="font-medium">ุญุฐู ุงูุญุณุงุจ</span>
              <span>โ๏ธ</span>
            </button>
          </div>
        </div>

        <div class="text-center text-sm text-gray-500 py-4">
          <p>SJA Money Tracker v2.0</p>
          <p class="mt-1">ุตููุน ุจู โค๏ธ ูู ุงูุณุนูุฏูุฉ</p>
        </div>
      </div>
    </div>

    <!-- PAGE: SYSTEM TESTS (Developer Dashboard) -->
    <div x-show="page === 'tests'" x-transition.opacity>
      <header class="mb-8">
        <h1 class="text-2xl font-bold text-gray-900">๐งช ุงุฎุชุจุงุฑุงุช ุงููุทูุฑ</h1>
        <p class="text-gray-500 text-sm mt-1">ุชุดุบูู ููุญุต ุฌููุน ุงุฎุชุจุงุฑุงุช ุงููุธุงู</p>
      </header>

      <div class="space-y-6">
        <!-- Warning Banner -->
        <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-6">
          <div class="flex items-start gap-3">
            <span class="text-2xl">โ๏ธ</span>
            <div>
              <h3 class="font-bold text-yellow-900 mb-2">ุชุญุฐูุฑ ูููุทูุฑูู</h3>
              <p class="text-yellow-800 text-sm">ูุฐู ุงูุตูุญุฉ ูุฎุตุตุฉ ูููุทูุฑูู ููุท. ูุง ุชูู ุจุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช ูุง ูู ุชููู ูุธุงุฆููุง. ุจุนุถ ุงูุงุฎุชุจุงุฑุงุช ูุฏ ุชูุดุฆ ุจูุงูุงุช ุชุฌุฑูุจูุฉ.</p>
            </div>
          </div>
        </div>

        <!-- Main Test Suites -->
        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
          <h2 class="font-bold text-gray-900 mb-4 flex items-center gap-2">
            <span>๐ฏ</span> ูุฌููุนุงุช ุงูุงุฎุชุจุงุฑ ุงูุฑุฆูุณูุฉ
          </h2>
          <div class="space-y-3">
            <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition">
              <div class="flex items-center justify-between mb-2">
                <h3 class="font-semibold text-gray-900">RUN_MASTER_TESTS</h3>
                <span class="px-2 py-1 bg-green-100 text-green-700 text-xs font-bold rounded">49 tests</span>
              </div>
              <p class="text-sm text-gray-600 mb-3">ุงูุงุฎุชุจุงุฑ ุงูุดุงูู ูุฌููุน ูุธุงุฆู ุงููุธุงู (Config, Sheets, Flow, AI, Webhook, Data Integrity)</p>
              <button onclick="google.script.run.withSuccessHandler((r) => {alert('โ ูุชูุฌุฉ: '+JSON.stringify(r, null, 2));}).withFailureHandler((e) => {alert('โ ุฎุทุฃ: '+e);}).RUN_MASTER_TESTS();" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700">
                โถ๏ธ ุชุดุบูู
              </button>
            </div>

            <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition">
              <div class="flex items-center justify-between mb-2">
                <h3 class="font-semibold text-gray-900">RUN_COMPREHENSIVE_VALIDATION</h3>
                <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs font-bold rounded">API Tests</span>
              </div>
              <p class="text-sm text-gray-600 mb-3">ูุญุต ุฌููุน ุฏูุงู API ุงูุฎูููุฉ (SOV1_UI_*) ูุงูุชุญูู ูู ุตูุงุญูุฉ ุงูุฑุฏูุฏ</p>
              <button onclick="google.script.run.withSuccessHandler((r) => {alert('โ ูุชูุฌุฉ: '+JSON.stringify(r, null, 2));}).withFailureHandler((e) => {alert('โ ุฎุทุฃ: '+e);}).RUN_COMPREHENSIVE_VALIDATION();" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700">
                โถ๏ธ ุชุดุบูู
              </button>
            </div>

            <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition">
              <div class="flex items-center justify-between mb-2">
                <h3 class="font-semibold text-gray-900">AUTO_TEST_ALL_PAGES</h3>
                <span class="px-2 py-1 bg-purple-100 text-purple-700 text-xs font-bold rounded">Frontend Tests</span>
              </div>
              <p class="text-sm text-gray-600 mb-3">ุงุฎุชุจุงุฑ ุฌููุน ุตูุญุงุช ุงููุงุฌูุฉ ุงูุฃูุงููุฉ (Settings, Index, Features, Onboarding, Backend)</p>
              <button onclick="google.script.run.withSuccessHandler((r) => {alert('โ ูุชูุฌุฉ: '+JSON.stringify(r, null, 2));}).withFailureHandler((e) => {alert('โ ุฎุทุฃ: '+e);}).AUTO_TEST_ALL_PAGES();" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700">
                โถ๏ธ ุชุดุบูู
              </button>
            </div>

            <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition">
              <div class="flex items-center justify-between mb-2">
                <h3 class="font-semibold text-gray-900">DEV_TEST_SMS_FLOW</h3>
                <span class="px-2 py-1 bg-orange-100 text-orange-700 text-xs font-bold rounded">E2E Test</span>
              </div>
              <p class="text-sm text-gray-600 mb-3">ุงุฎุชุจุงุฑ ุดุงูู: SMS โ AI โ Sheets โ Telegram (ููุดุฆ ูุนุงููุฉ ุชุฌุฑูุจูุฉ)</p>
              <button onclick="google.script.run.withSuccessHandler((r) => {alert('โ ูุชูุฌุฉ: '+JSON.stringify(r, null, 2));}).withFailureHandler((e) => {alert('โ ุฎุทุฃ: '+e);}).DEV_TEST_SMS_FLOW();" class="px-4 py-2 bg-orange-600 text-white rounded-lg text-sm font-medium hover:bg-orange-700">
                โถ๏ธ ุชุดุบูู (ููุดุฆ ุจูุงูุงุช)
              </button>
            </div>
          </div>
        </div>

        <!-- Diagnostic Tests -->
        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
          <h2 class="font-bold text-gray-900 mb-4 flex items-center gap-2">
            <span>๐</span> ุงุฎุชุจุงุฑุงุช ุงูุชุดุฎูุต
          </h2>
          <div class="space-y-3">
            <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition">
              <h3 class="font-semibold text-gray-900 mb-2">DEBUG_SHEETS_INFO</h3>
              <p class="text-sm text-gray-600 mb-3">ุนุฑุถ ูุนูููุงุช ููุตูุฉ ุนู ุฌููุน ุงูุฃูุฑุงู ูุงูุจูุงูุงุช</p>
              <button onclick="google.script.run.withSuccessHandler((r) => {console.log(r); alert('โ ุชู! ุงูุธุฑ Console');}).withFailureHandler((e) => {alert('โ ุฎุทุฃ: '+e);}).DEBUG_SHEETS_INFO();" class="px-4 py-2 bg-gray-600 text-white rounded-lg text-sm font-medium hover:bg-gray-700">
                โถ๏ธ ุชุดุบูู
              </button>
            </div>

            <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition">
              <h3 class="font-semibold text-gray-900 mb-2">DEBUG_TELEGRAM_STATUS</h3>
              <p class="text-sm text-gray-600 mb-3">ูุญุต ุญุงูุฉ Webhook ูุงูุงุชุตุงู ุจุจูุช Telegram</p>
              <button onclick="google.script.run.withSuccessHandler((r) => {alert('โ ูุชูุฌุฉ: '+JSON.stringify(r, null, 2));}).withFailureHandler((e) => {alert('โ ุฎุทุฃ: '+e);}).DEBUG_TELEGRAM_STATUS();" class="px-4 py-2 bg-gray-600 text-white rounded-lg text-sm font-medium hover:bg-gray-700">
                โถ๏ธ ุชุดุบูู
              </button>
            </div>

            <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition">
              <h3 class="font-semibold text-gray-900 mb-2">testDashboardData</h3>
              <p class="text-sm text-gray-600 mb-3">ูุญุต ุจูุงูุงุช ููุญุฉ ุงูุชุญูู ูุงูุชุญูู ูู ุนุฏู ูุฌูุฏ null</p>
              <button onclick="google.script.run.withSuccessHandler((r) => {alert('โ ูุชูุฌุฉ: '+JSON.stringify(r, null, 2));}).withFailureHandler((e) => {alert('โ ุฎุทุฃ: '+e);}).testDashboardData();" class="px-4 py-2 bg-gray-600 text-white rounded-lg text-sm font-medium hover:bg-gray-700">
                โถ๏ธ ุชุดุบูู
              </button>
            </div>
          </div>
        </div>

        <!-- Parser Tests -->
        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
          <h2 class="font-bold text-gray-900 mb-4 flex items-center gap-2">
            <span>๐ค</span> ุงุฎุชุจุงุฑุงุช ุงููุญูู (Parser)
          </h2>
          <div class="space-y-3">
            <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition">
              <h3 class="font-semibold text-gray-900 mb-2">TEST_DATE_PARSING</h3>
              <p class="text-sm text-gray-600 mb-3">ูุญุต ูุฏุฑุฉ ุงููุญูู ุนูู ุงุณุชุฎุฑุงุฌ ุงูุชูุงุฑูุฎ ูู ุงููุตูุต</p>
              <button onclick="google.script.run.withSuccessHandler((r) => {console.log(r); alert('โ ุชู! ุงูุธุฑ Console');}).withFailureHandler((e) => {alert('โ ุฎุทุฃ: '+e);}).TEST_DATE_PARSING();" class="px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-700">
                โถ๏ธ ุชุดุบูู
              </button>
            </div>

            <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition">
              <h3 class="font-semibold text-gray-900 mb-2">TEST_BANK_DETECTION</h3>
              <p class="text-sm text-gray-600 mb-3">ุงุฎุชุจุงุฑ ุงููุดู ุนู ุงูุจููู ุงูุณุนูุฏูุฉ ูู ุงูุฑุณุงุฆู</p>
              <button onclick="google.script.run.withSuccessHandler((r) => {console.log(r); alert('โ ุชู! ุงูุธุฑ Console');}).withFailureHandler((e) => {alert('โ ุฎุทุฃ: '+e);}).TEST_BANK_DETECTION();" class="px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-700">
                โถ๏ธ ุชุดุบูู
              </button>
            </div>

            <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition">
              <h3 class="font-semibold text-gray-900 mb-2">TEST_ACCOUNT_IDENTIFICATION</h3>
              <p class="text-sm text-gray-600 mb-3">ูุญุต ุงุณุชุฎุฑุงุฌ ูุนูููุงุช ุงูุญุณุงุจุงุช ุงูุจูููุฉ</p>
              <button onclick="google.script.run.withSuccessHandler((r) => {console.log(r); alert('โ ุชู! ุงูุธุฑ Console');}).withFailureHandler((e) => {alert('โ ุฎุทุฃ: '+e);}).TEST_ACCOUNT_IDENTIFICATION();" class="px-4 py-2 bg-indigo-600 text-white rounded-lg text-sm font-medium hover:bg-indigo-700">
                โถ๏ธ ุชุดุบูู
              </button>
            </div>
          </div>
        </div>

        <!-- Documentation -->
        <div class="bg-blue-50 border border-blue-200 rounded-xl p-6">
          <h3 class="font-bold text-blue-900 mb-3 flex items-center gap-2">
            <span>๐</span> ุงูุชูุซูู
          </h3>
          <ul class="space-y-2 text-sm text-blue-800">
            <li class="flex gap-2">
              <span>โข</span> 
              <span>ููุญุตูู ุนูู ูุชุงุฆุฌ ููุตูุฉุ ุงูุชุญ <strong>Console</strong> (F12 โ Console)</span>
            </li>
            <li class="flex gap-2">
              <span>โข</span> 
              <span>ููููู ุฃูุถุงู ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช ูู <strong>Apps Script Editor</strong> โ Extensions โ Apps Script</span>
            </li>
            <li class="flex gap-2">
              <span>โข</span> 
              <span>ุฑุงุฌุน <code class="bg-blue-100 px-1 rounded">TESTING.md</code> ููุญุตูู ุนูู ุฏููู ูุงูู</span>
            </li>
            <li class="flex gap-2">
              <span>โข</span> 
              <span>ุงููุชูุฌุฉ ุงููุชููุนุฉ: RUN_MASTER_TESTS ูุฌุจ ุฃู ููุธูุฑ โ 49/49 ุงุฎุชุจุงุฑ ูุงุฌุญ</span>
            </li>
          </ul>
        </div>

        <!-- System Health Status -->
        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
          <h2 class="font-bold text-gray-900 mb-4 flex items-center gap-2">
            <span>โค๏ธ</span> ุญุงูุฉ ุงููุธุงู
          </h2>
          <div class="grid grid-cols-2 gap-4">
            <div class="p-4 bg-green-50 rounded-lg">
              <div class="text-sm text-gray-600 mb-1">Backend Functions</div>
              <div class="text-2xl font-bold text-green-700">20+</div>
              <div class="text-xs text-gray-500">SOV1_UI_* wrappers</div>
            </div>
            <div class="p-4 bg-blue-50 rounded-lg">
              <div class="text-sm text-gray-600 mb-1">Test Suites</div>
              <div class="text-2xl font-bold text-blue-700">10+</div>
              <div class="text-xs text-gray-500">Available tests</div>
            </div>
            <div class="p-4 bg-purple-50 rounded-lg">
              <div class="text-sm text-gray-600 mb-1">Pages</div>
              <div class="text-2xl font-bold text-purple-700">7</div>
              <div class="text-xs text-gray-500">Dashboard, Txns, Budgets, etc.</div>
            </div>
            <div class="p-4 bg-orange-50 rounded-lg">
              <div class="text-sm text-gray-600 mb-1">Coverage</div>
              <div class="text-2xl font-bold text-orange-700">100%</div>
              <div class="text-xs text-gray-500">All features have UI</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- PAGE: REPORTS -->
    <div x-show="page === 'reports'" x-transition.opacity>
      <header class="mb-8">
        <h1 class="text-2xl font-bold text-gray-900">ุงูุชูุงุฑูุฑ</h1>
        <p class="text-gray-500 text-sm mt-1">ุชูุงุฑูุฑ ุดุงููุฉ ุนู ูุตุฑููุงุชู ูุฏุฎูู</p>
      </header>
      
      <div class="grid md:grid-cols-3 gap-4 mb-8">
        <button @click="loadReport('daily')" class="p-6 bg-white rounded-xl border-2 border-gray-200 hover:border-green-500 transition" :class="reportPeriod === 'daily' ? 'border-green-500 bg-green-50' : ''">
          <div class="text-3xl mb-2">๐</div>
          <div class="font-bold text-gray-900">ุชูุฑูุฑ ุงูููู</div>
        </button>
        <button @click="loadReport('weekly')" class="p-6 bg-white rounded-xl border-2 border-gray-200 hover:border-green-500 transition" :class="reportPeriod === 'weekly' ? 'border-green-500 bg-green-50' : ''">
          <div class="text-3xl mb-2">๐</div>
          <div class="font-bold text-gray-900">ุชูุฑูุฑ ุงูุฃุณุจูุน</div>
        </button>
        <button @click="loadReport('monthly')" class="p-6 bg-white rounded-xl border-2 border-gray-200 hover:border-green-500 transition" :class="reportPeriod === 'monthly' ? 'border-green-500 bg-green-50' : ''">
          <div class="text-3xl mb-2">๐</div>
          <div class="font-bold text-gray-900">ุชูุฑูุฑ ุงูุดูุฑ</div>
        </button>
      </div>
      
      <div x-show="!reportData" class="bg-white rounded-2xl shadow-sm border border-gray-100 p-8 text-center">
        <div class="text-6xl mb-4">๐</div>
        <h3 class="text-xl font-bold text-gray-900 mb-2">ุงุฎุชุฑ ูุชุฑุฉ ุงูุชูุฑูุฑ</h3>
        <p class="text-gray-600">ุงููุฑ ุนูู ุฃุญุฏ ุงูุฃุฒุฑุงุฑ ุฃุนูุงู ูุนุฑุถ ุงูุชูุฑูุฑ</p>
      </div>
      
      <div x-show="reportData" class="space-y-6">
        <!-- Stats -->
        <div class="grid md:grid-cols-4 gap-4">
          <div class="bg-white rounded-xl border border-gray-200 p-6">
            <div class="text-sm text-gray-600 mb-1">ุงูุฏุฎู</div>
            <div class="text-2xl font-bold text-green-600" x-text="formatMoney(reportData?.income || 0)">0</div>
          </div>
          <div class="bg-white rounded-xl border border-gray-200 p-6">
            <div class="text-sm text-gray-600 mb-1">ุงููุตุฑููุงุช</div>
            <div class="text-2xl font-bold text-red-600" x-text="formatMoney(reportData?.expenses || 0)">0</div>
          </div>
          <div class="bg-white rounded-xl border border-gray-200 p-6">
            <div class="text-sm text-gray-600 mb-1">ุงูุงุฏุฎุงุฑ</div>
            <div class="text-2xl font-bold" :class="(reportData?.savings || 0) >= 0 ? 'text-green-600' : 'text-red-600'" x-text="formatMoney(reportData?.savings || 0)">0</div>
          </div>
          <div class="bg-white rounded-xl border border-gray-200 p-6">
            <div class="text-sm text-gray-600 mb-1">ุนุฏุฏ ุงูุนูููุงุช</div>
            <div class="text-2xl font-bold text-blue-600" x-text="reportData?.transactionCount || 0">0</div>
          </div>
        </div>
        
        <!-- Category Breakdown -->
        <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
          <h3 class="font-bold text-gray-900 mb-4">ุงููุตุฑููุงุช ุญุณุจ ุงูุชุตููู</h3>
          <div class="space-y-3">
            <template x-for="item in (reportData?.chartData || [])" :key="item.category">
              <div>
                <div class="flex justify-between text-sm mb-1">
                  <span x-text="item.category">ุงูุชุตููู</span>
                  <span class="font-bold" x-text="formatMoney(item.amount)">0</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                  <div class="h-2 rounded-full bg-green-500" :style="'width: ' + (item.amount / (reportData?.expenses || 1) * 100) + '%'"></div>
                </div>
              </div>
            </template>
          </div>
        </div>
      </div>
    </div>

    <!-- PAGE: ACCOUNTS -->
    <div x-show="page === 'accounts'" x-transition.opacity>
      <header class="mb-8 flex justify-between items-center">
        <div>
          <h1 class="text-2xl font-bold text-gray-900">ุงูุญุณุงุจุงุช ุงูุจูููุฉ</h1>
          <p class="text-gray-500 text-sm mt-1">ุฅุฏุงุฑุฉ ุญุณุงุจุงุชู ูุจุทุงูุงุชู ุงูุจูููุฉ</p>
        </div>
        <button @click="openAccountModal()" class="px-6 py-3 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 transition flex items-center gap-2">
          <span>โ</span> ุฅุถุงูุฉ ุญุณุงุจ
        </button>
      </header>
      
      <div x-show="accounts.length === 0" class="bg-white rounded-2xl shadow-sm border border-gray-100 p-12 text-center">
        <div class="text-6xl mb-4">๐ฆ</div>
        <h3 class="text-xl font-bold text-gray-900 mb-2">ูุง ุชูุฌุฏ ุญุณุงุจุงุช</h3>
        <p class="text-gray-600 mb-6">ุฃุถู ุญุณุงุจุงุชู ุงูุจูููุฉ ูุชุชุจุน ุฃุฑุตุฏุชู ูุนูููุงุชู ุงููุงููุฉ</p>
        <button @click="openAccountModal()" class="px-6 py-3 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 transition shadow-lg">
          โ ุฅุถุงูุฉ ุฃูู ุญุณุงุจ
        </button>
      </div>
        <button @click="openAccountModal()" class="px-6 py-3 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 transition">
          โ ุฅุถุงูุฉ ุฃูู ุญุณุงุจ
        </button>
      </div>
      
      <div x-show="accounts.length > 0" class="grid md:grid-cols-2 gap-6">
        <template x-for="account in accounts" :key="account.id">
          <div class="bg-gradient-to-br from-green-600 to-green-700 rounded-2xl shadow-lg p-6 text-white relative">
            <div class="absolute top-4 left-4 flex gap-2">
              <button @click="editAccount(account)" class="w-8 h-8 bg-white/20 hover:bg-white/30 rounded-lg flex items-center justify-center">
                โ๏ธ
              </button>
              <button @click="deleteAccount(account)" class="w-8 h-8 bg-white/20 hover:bg-white/30 rounded-lg flex items-center justify-center">
                ๐๏ธ
              </button>
            </div>
            <div class="flex justify-between items-start mb-8 pr-20">
              <div>
                <p class="text-sm font-medium mb-1" x-text="account.name">ุงุณู ุงูุญุณุงุจ</p>
                <p class="text-xs opacity-75" x-text="account.type + ' โข ' + account.bank">ุงูุชูุงุตูู</p>
              </div>
              <div class="text-2xl">
                <span x-show="account.type === 'ุจูู'">๐ฆ</span>
                <span x-show="account.type === 'ุจุทุงูุฉ'">๐ณ</span>
                <span x-show="account.type === 'ูุญูุธุฉ'">๐</span>
              </div>
            </div>
            <div class="mb-2">
              <p class="text-xs opacity-75 mb-1">ุฑูู ุงูุญุณุงุจ</p>
              <p class="text-lg font-mono tracking-wider" x-text="account.number || 'ุบูุฑ ูุญุฏุฏ'">****</p>
            </div>
            <div class="flex gap-2 mt-4">
              <span x-show="account.isMine" class="px-2 py-1 bg-white/20 rounded text-xs">ุญุณุงุจู</span>
              <span x-show="account.isInternal" class="px-2 py-1 bg-white/20 rounded text-xs">ุชุญููู ุฏุงุฎูู</span>
            </div>
          </div>
        </template>
      </div>
    </div>

  </main>

  <!-- Add Transaction Modal -->
  <div x-show="showAddModal" @click.self="showAddModal = false" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4" x-transition>
    <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6" @click.stop>
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-bold text-gray-900">ุฅุถุงูุฉ ุนูููุฉ ุฌุฏูุฏุฉ</h2>
        <button @click="showAddModal = false" class="text-gray-400 hover:text-gray-600">โ</button>
      </div>
      
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">ููุน ุงูุนูููุฉ</label>
          <div class="grid grid-cols-2 gap-3">
            <button @click="newTransaction.type = 'expense'" :class="newTransaction.type === 'expense' ? 'bg-red-500 text-white' : 'bg-gray-100 text-gray-700'" class="px-4 py-3 rounded-lg font-medium transition">
              ๐ธ ูุตุฑูู
            </button>
            <button @click="newTransaction.type = 'income'" :class="newTransaction.type === 'income' ? 'bg-green-500 text-white' : 'bg-gray-100 text-gray-700'" class="px-4 py-3 rounded-lg font-medium transition">
              ๐ฐ ุฏุฎู
            </button>
          </div>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">ุงููุจูุบ</label>
          <input type="number" x-model="newTransaction.amount" placeholder="0.00" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">ุงูุชุงุฌุฑ / ุงููุตู</label>
          <input type="text" x-model="newTransaction.merchant" placeholder="ุงุณู ุงููุชุฌุฑ ุฃู ูุตู ุงูุนูููุฉ" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">ุงูุชุตููู</label>
          <select x-model="newTransaction.category" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
            <template x-for="cat in categories" :key="cat">
              <option :value="cat" x-text="cat"></option>
            </template>
          </select>
        </div>
        
        <div class="flex gap-3 pt-4">
          <button @click="showAddModal = false" class="flex-1 px-6 py-3 border border-gray-300 rounded-lg font-medium text-gray-700 hover:bg-gray-50 transition">
            ุฅูุบุงุก
          </button>
          <button @click="addTransaction()" class="flex-1 px-6 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition">
            โ ุฅุถุงูุฉ
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Budget Modal -->
  <div x-show="showBudgetModal" @click.self="showBudgetModal = false" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4" x-transition>
    <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6" @click.stop>
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-bold text-gray-900" x-text="editingBudget ? 'ุชุนุฏูู ุงูููุฒุงููุฉ' : 'ุฅุถุงูุฉ ููุฒุงููุฉ ุฌุฏูุฏุฉ'">ุฅุถุงูุฉ ููุฒุงููุฉ</h2>
        <button @click="showBudgetModal = false" class="text-gray-400 hover:text-gray-600">โ</button>
      </div>
      
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">ุงูุชุตููู</label>
          <select x-model="newBudget.category" :disabled="editingBudget !== null" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent disabled:bg-gray-100">
            <option value="">ุงุฎุชุฑ ุงูุชุตููู</option>
            <template x-for="cat in categories" :key="cat">
              <option :value="cat" x-text="cat"></option>
            </template>
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">ุงูุญุฏ ุงูุฃูุตู (SAR)</label>
          <input type="number" x-model="newBudget.limit" placeholder="0.00" step="0.01" min="0" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
        </div>
        
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
          <p class="text-sm text-blue-800">
            ๐ก ุณูุชู ุชูุจููู ุนูุฏูุง ุชุตู ุงููุตุฑููุงุช ุฅูู 80% ูู ุงูุญุฏ ุงูุฃูุตู
          </p>
        </div>
        
        <div class="flex gap-3 pt-4">
          <button @click="showBudgetModal = false" class="flex-1 px-6 py-3 border border-gray-300 rounded-lg font-medium text-gray-700 hover:bg-gray-50 transition">
            ุฅูุบุงุก
          </button>
          <button @click="addOrEditBudget()" class="flex-1 px-6 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition">
            โ ุญูุธ
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Account Modal -->
  <div x-show="showAccountModal" class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50" x-transition>
    <div @click.outside="showAccountModal = false" class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto">
      <h3 class="text-xl font-bold text-gray-900 mb-6" x-text="editingAccount ? 'ุชุนุฏูู ุญุณุงุจ' : 'ุฅุถุงูุฉ ุญุณุงุจ ุฌุฏูุฏ'">ุฅุถุงูุฉ ุญุณุงุจ</h3>
      
      <!-- AI Smart Extraction - Collapsible -->
      <div x-show="!editingAccount" class="mb-6">
        <button 
          @click="showAIExtraction = !showAIExtraction"
          class="w-full flex items-center justify-between p-4 bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl border-2 border-purple-200 hover:border-purple-300 transition"
        >
          <div class="flex items-center gap-2">
            <span class="text-2xl">๐ค</span>
            <span class="font-bold text-purple-900">ุงุณุชุฎุฑุงุฌ ุฐูู ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู</span>
          </div>
          <span x-text="showAIExtraction ? 'โผ' : 'โ'" class="text-purple-600 font-bold"></span>
        </button>
        
        <div x-show="showAIExtraction" x-transition class="mt-3 p-4 bg-purple-50/50 rounded-xl border border-purple-100">
          <p class="text-sm text-purple-700 mb-3">ุงูุตู ุฑุณุงูุฉ SMS ูู ุงูุจูู ูุณูููู ุงููุธุงู ุจุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช ุชููุงุฆูุงู</p>
          <textarea x-model="newAccount.smsText" placeholder="ูุซุงู: ุชู ุงูุดุฑุงุก ูู AMAZON ุจูุจูุบ 299.00 SAR ูู ุจุทุงูุฉ ุงูุฑุงุฌุญู **9767" rows="3" class="w-full px-4 py-3 border border-purple-300 rounded-lg focus:ring-2 focus:ring-purple-500 mb-3 text-sm"></textarea>
          <button @click="extractFromSMS()" class="w-full px-4 py-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg font-bold hover:from-purple-700 hover:to-blue-700 transition flex items-center justify-center gap-2">
            <span>โจ</span> ุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช ูู ุงูุฑุณุงูุฉ
          </button>
        </div>
      </div>
      
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">ุงุณู ุงูุญุณุงุจ *</label>
          <input type="text" x-model="newAccount.name" placeholder="ูุซุงู: ุงูุฑุงุฌุญู 9767" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">ุงูููุน *</label>
          <select x-model="newAccount.type" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
            <option value="ุจูู">ุจูู</option>
            <option value="ุจุทุงูุฉ">ุจุทุงูุฉ</option>
            <option value="ูุญูุธุฉ">ูุญูุธุฉ ุฅููุชุฑูููุฉ</option>
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">ุฑูู ุงูุญุณุงุจ / ุขุฎุฑ 4 ุฃุฑูุงู</label>
          <input type="text" x-model="newAccount.number" placeholder="9767 ุฃู 0305" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">ุงูุจูู / ุงูุฌูุฉ</label>
          <input type="text" x-model="newAccount.bank" placeholder="AlrajhiBank, STC Pay, ุฅูุฎ" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">ุฃุณูุงุก ุจุฏููุฉ (ููุตููุฉ ุจูุงุตูุฉ)</label>
          <input type="text" x-model="newAccount.aliases" placeholder="ุงูุฑุงุฌุญู,alrajhi,alrajhi bank" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
        </div>
        
        <div class="flex gap-4">
          <label class="flex items-center gap-2 cursor-pointer">
            <input type="checkbox" x-model="newAccount.isMine" class="w-5 h-5 text-green-600 rounded">
            <span class="text-sm text-gray-700">ุญุณุงุจู</span>
          </label>
          
          <label class="flex items-center gap-2 cursor-pointer">
            <input type="checkbox" x-model="newAccount.isInternal" class="w-5 h-5 text-green-600 rounded">
            <span class="text-sm text-gray-700">ุชุญููู ุฏุงุฎูู</span>
          </label>
        </div>
        
        <div class="flex gap-3 pt-4">
          <button @click="showAccountModal = false" class="flex-1 px-6 py-3 border border-gray-300 rounded-lg font-medium text-gray-700 hover:bg-gray-50 transition">
            ุฅูุบุงุก
          </button>
          <button @click="saveAccount()" class="flex-1 px-6 py-3 bg-green-600 text-white rounded-lg font-medium hover:bg-green-700 transition">
            โ ุญูุธ
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Notifications -->
  <div class="fixed top-4 left-4 z-50 space-y-2">
    <template x-for="toast in toasts" :key="toast.id">
      <div 
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="transform translate-x-full opacity-0"
        x-transition:enter-end="transform translate-x-0 opacity-100"
        x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="transform translate-x-0 opacity-100"
        x-transition:leave-end="transform translate-x-full opacity-0"
        class="px-6 py-4 rounded-xl shadow-lg flex items-center gap-3 min-w-[300px]"
        :class="toast.type === 'success' ? 'bg-green-600 text-white' : 'bg-red-600 text-white'"
      >
        <span x-text="toast.type === 'success' ? 'โ' : 'โ'" class="text-2xl"></span>
        <span x-text="toast.message" class="font-medium"></span>
      </div>
    </template>
  </div>

  <!-- Edit Transaction Modal -->
  <div x-show="showEditTransactionModal" class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50" x-transition>
    <div @click.outside="showEditTransactionModal = false" class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6">
      <h3 class="text-xl font-bold text-gray-900 mb-6">ุชุนุฏูู ุงูุนูููุฉ</h3>
      
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">ุงูุชุงุฌุฑ *</label>
          <input type="text" x-model="newTransaction.merchant" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-green-500">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">ุงููุจูุบ *</label>
          <input type="number" step="0.01" x-model="newTransaction.amount" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-green-500">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">ุงูุชุตููู</label>
          <select x-model="newTransaction.category" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-green-500">
            <template x-for="cat in categories" :key="cat">
              <option :value="cat" x-text="cat"></option>
            </template>
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">ููุงุญุธุงุช</label>
          <textarea x-model="newTransaction.notes" rows="2" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-green-500"></textarea>
        </div>
        
        <div class="flex gap-3 pt-4">
          <button @click="showEditTransactionModal = false" class="flex-1 px-6 py-3 border border-gray-300 rounded-lg font-medium text-gray-700 hover:bg-gray-50">
            ุฅูุบุงุก
          </button>
          <button @click="saveEditedTransaction()" class="flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700">
            ุญูุธ ุงูุชุนุฏููุงุช
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Privacy Policy Modal -->
  <div x-show="showPrivacyModal" x-cloak class="fixed inset-0 z-50 overflow-y-auto" style="background: rgba(0,0,0,0.5);">
    <div class="flex items-center justify-center min-h-screen p-4">
      <div @click.away="showPrivacyModal = false" class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-y-auto">
        <div class="sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between">
          <h2 class="text-2xl font-bold text-gray-900">๐ ุณูุงุณุฉ ุงูุฎุตูุตูุฉ</h2>
          <button @click="showPrivacyModal = false" class="text-gray-400 hover:text-gray-600">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
        
        <div class="p-6 space-y-4 text-right">
          <div>
            <h3 class="font-bold text-lg text-gray-900 mb-2">๐ ุฌูุน ุงูุจูุงูุงุช</h3>
            <p class="text-gray-700">ูุญู ูุฌูุน ููุท ุงูุจูุงูุงุช ุงูุชู ุชุฏุฎููุง ุจููุณู: ุงูุนูููุงุช ุงููุงููุฉุ ุงูููุฒุงููุงุชุ ุงูุญุณุงุจุงุชุ ูุงูุฅุนุฏุงุฏุงุช.</p>
          </div>
          
          <div>
            <h3 class="font-bold text-lg text-gray-900 mb-2">๐ ุชุฎุฒูู ุงูุจูุงูุงุช</h3>
            <p class="text-gray-700">ุฌููุน ุจูุงูุงุชู ูุฎุฒูุฉ ูู ุฌุฏุงูู Google Sheets ุงูุฎุงุตุฉ ุจู. ูุญู ูุง ูุฎุฒู ุฃู ุจูุงูุงุช ุนูู ุฎูุงุฏู ุฎุงุฑุฌูุฉ.</p>
          </div>
          
          <div>
            <h3 class="font-bold text-lg text-gray-900 mb-2">๐ค ุงุณุชุฎุฏุงู ุงูุฐูุงุก ุงูุงุตุทูุงุนู</h3>
            <p class="text-gray-700">ูุณุชุฎุฏู GROQ API ู Gemini ูุชุญููู ุงูุฑุณุงุฆู ุงููุตูุฉ ูุงุณุชุฎุฑุงุฌ ุจูุงูุงุช ุงูุนูููุงุช. ูุชู ุฅุฑุณุงู ูุต ุงูุฑุณุงูุฉ ููุทุ ุฏูู ุฃู ูุนูููุงุช ุดุฎุตูุฉ.</p>
          </div>
          
          <div>
            <h3 class="font-bold text-lg text-gray-900 mb-2">๐ฑ Telegram Bot</h3>
            <p class="text-gray-700">ุฅุฐุง ููุช ุจุชูุนูู ุฅุดุนุงุฑุงุช Telegramุ ุณูุชู ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ุฅูู ุฑูู ุงูุฏุฑุฏุดุฉ ุงููุญุฏุฏ. ูุง ูุดุงุฑู ุจูุงูุงุชู ูุน ุฃุทุฑุงู ุซุงูุซุฉ.</p>
          </div>
          
          <div>
            <h3 class="font-bold text-lg text-gray-900 mb-2">๐๏ธ ุญุฐู ุงูุจูุงูุงุช</h3>
            <p class="text-gray-700">ููููู ุญุฐู ุญุณุงุจู ูุฌููุน ุจูุงูุงุชู ูู ุฃู ููุช ูู ุตูุญุฉ ุงูุฅุนุฏุงุฏุงุช. ุงูุญุฐู ููุงุฆู ููุง ูููู ุงูุชุฑุงุฌุน ุนูู.</p>
          </div>
          
          <div>
            <h3 class="font-bold text-lg text-gray-900 mb-2">๐ ุงูุฃูุงู</h3>
            <p class="text-gray-700">ุงูุชุทุจูู ูุนูู ุนูู Google Apps Script ูุน ุจุฑูุชูููู HTTPS. ุฌููุน ุงูุจูุงูุงุช ูุญููุฉ ุจูุธุงู ุฃูุงู Google.</p>
          </div>
          
          <div class="border-t border-gray-200 pt-4 mt-4">
            <p class="text-sm text-gray-600">ุขุฎุฑ ุชุญุฏูุซ: ููุงูุฑ 2026</p>
            <p class="text-sm text-gray-600 mt-2">ููุงุณุชูุณุงุฑุงุช: <a href="mailto:support@sjatracker.com" class="text-green-600 hover:underline">support@sjatracker.com</a></p>
          </div>
          
          <button @click="showPrivacyModal = false" class="w-full px-6 py-3 bg-green-600 text-white rounded-lg font-bold hover:bg-green-700 transition">
            ูููุช
          </button>
        </div>
      </div>
    </div>
  </div>

</body>
</html>
