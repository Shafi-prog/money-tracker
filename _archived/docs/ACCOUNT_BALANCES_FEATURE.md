# ๐ฐ ููุฒุฉ ุฑุตุฏ ุงูุญุณุงุจุงุช ุงููุงููุฉ
# Account Balances Tracking Feature

## ๐ ูุธุฑุฉ ุนุงูุฉ / Overview

ุชู ุฅุถุงูุฉ ููุฒุฉ ุดุงููุฉ ูุชุชุจุน ุฃุฑุตุฏุฉ ุงูุญุณุงุจุงุช ุงููุตุฑููุฉ ูู ุจูุช ุงูุชููุฌุฑุงู. ุงูุขู ููููู:
- ุนุฑุถ ุฑุตูุฏ ุฌููุน ุญุณุงุจุงุชู ูู ุฃู ููุช
- **ุชููู ุฅุดุนุงุฑ ุชููุงุฆู ุจุนุฏ ูู ุนูููุฉ** ูุน ุงูุฑุตูุฏ ุงูุฌุฏูุฏ
- ุชุญุฏูุซ ุงูุฃุฑุตุฏุฉ ุชููุงุฆูุงู ุนูุฏ ุฅุถุงูุฉ ุนูููุงุช
- ุชุชุจุน ุงูุชุญูููุงุช ุจูู ุงูุญุณุงุจุงุช
- **ูู ุนูููุฉ ููุง ูุนุฑู ูุฑูุฏ (UUID) ูู Google Sheets**

A comprehensive feature for tracking bank account balances in the Telegram bot. Now you can:
- View balances of all your accounts anytime
- **Receive automatic notification after each transaction** with new balance
- Automatically update balances when adding transactions
- Track transfers between accounts
- **Each transaction has a unique ID (UUID) in Google Sheets**

---

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู / How to Use

### 1๏ธโฃ ุงูุฅุดุนุงุฑุงุช ุงูุชููุงุฆูุฉ / Automatic Notifications

**ุจุนุฏ ูู ุนูููุฉ ูุงููุฉุ ุณุชุชููู ุฅุดุนุงุฑุงู ูุซู:**

```
๐ฆ ุชุญุฏูุซ ุฑุตูุฏ ุงูุญุณุงุจ
โโโโโโโโโโโโโโโโโโโ

๐ณ ุงูุนูููุฉ: ูุดุชุฑูุงุช
๐ผ ุงูุญุณุงุจ: AlrajhiBank
๐ต ุงููุจูุบ: 150.50 SAR
๐ช ุงูุฌูุฉ: ุฌุฑูุฑ

๐ฐ ุงูุฑุตูุฏ ุงูุฌุฏูุฏ: 14849.50 SAR

๐ ููุงุญุธุฉ: ุงูุฑุตูุฏ ุชูุฏูุฑู
```

### 2๏ธโฃ ุนุฑุถ ุฌููุน ุงูุฃุฑุตุฏุฉ / View All Balances

ููุงู ุนุฏุฉ ุทุฑู ูุนุฑุถ ุฃุฑุตุฏุฉ ุญุณุงุจุงุชู:

**ูู ููุญุฉ ุงูุชุญูู:**
- ุงุถุบุท ุนูู ุฒุฑ "๐ฐ ุฑุตุฏ ูุงูู"

**ูู ุงูุฃูุงูุฑ:**
```
/balances
/ุฑุตุฏ
ุฑุตุฏ ูุงูู
```

### 3๏ธโฃ ูุซุงู ุนูู ุงูุชูุฑูุฑ / Full Report Example

ุนูุฏ ุงุณุชุฎุฏุงู ุงูุฃูุฑุ ุณุชุญุตู ุนูู ุชูุฑูุฑ ูุซู:

```
๐ฐ ุฑุตุฏ ูุงูู - ุฃุฑุตุฏุฉ ุงูุญุณุงุจุงุช
โโโโโโโโโโโโโโโโโโโ

๐ AlrajhiBank: 15000.00 SAR
๐ฆ Tiqmo: 5000.00 SAR
๐ณ Alinma: 3000.00 SAR

โโโโโโโโโโโโโโโโโโโ
๐ฐ ุฅุฌูุงูู ุงูุฃุฑุตุฏุฉ: 23000.00 SAR

๐ ููุงุญุธุฉ: ุงูุฃุฑุตุฏุฉ ุชูุฏูุฑูุฉ ุจูุงุกู ุนูู ุงูุนูููุงุช ุงููุณุฌูุฉ
```

---

## โ๏ธ ุงูุชุญุฏูุซ ุงูุชููุงุฆู / Automatic Updates

### ููู ุชุนูู ุงูุฃุฑุตุฏุฉ:

**1๏ธโฃ ุจุนุฏ ูู ุดุฑุงุก:**
```
SMS: ุดุฑุงุก 150 ุฑูุงู ูู ุฌุฑูุฑ
โ ูุนุงูุฌุฉ ุชููุงุฆูุฉ
โ ุชุญุฏูุซ ุฑุตูุฏ AlrajhiBank: -150
โ ุฅุดุนุงุฑ ููุฑู ุจุงูุฑุตูุฏ ุงูุฌุฏูุฏ
```

**2๏ธโฃ ุจุนุฏ ูู ุฅูุฏุงุน:**
```
SMS: ุฅูุฏุงุน 10000 ุฑูุงู (ุฑุงุชุจ)
โ ูุนุงูุฌุฉ ุชููุงุฆูุฉ
โ ุชุญุฏูุซ ุฑุตูุฏ AlrajhiBank: +10000
โ ุฅุดุนุงุฑ ููุฑู ุจุงูุฑุตูุฏ ุงูุฌุฏูุฏ
```

**3๏ธโฃ ุนูุฏ ุงูุชุญููู ุจูู ุงูุญุณุงุจุงุช:**
```
SMS: ุชุญููู 1000 ุฑูุงู ูู ุงูุฑุงุฌุญู ุฅูู ุชููู
โ ูุนุงูุฌุฉ ุชููุงุฆูุฉ
โ ุชุญุฏูุซ ุฑุตูุฏ AlrajhiBank: -1000
โ ุฅุดุนุงุฑ ุจุงูุฑุตูุฏ ุงูุฌุฏูุฏ ููุฑุงุฌุญู
โ ุชุญุฏูุซ ุฑุตูุฏ Tiqmo: +1000
โ ุฅุดุนุงุฑ ุจุงูุฑุตูุฏ ุงูุฌุฏูุฏ ูุชููู
```

**โจ ููุงุญุธุฉ ูููุฉ:** ุณุชุญุตู ุนูู **3 ุฅุดุนุงุฑุงุช** ูู ุญุงูุฉ ุงูุชุญููู ุซู ุงูุดุฑุงุก:
1. ุจุนุฏ ุชุญููู ูู ุงูุฑุงุฌุญู (ุฑุตูุฏ ุฌุฏูุฏ ุงูุฑุงุฌุญู)
2. ุจุนุฏ ุงุณุชูุงู ูู ุชููู (ุฑุตูุฏ ุฌุฏูุฏ ุชููู)
3. ุจุนุฏ ุงูุดุฑุงุก ูู ุงูุฑุงุฌุญู (ุฑุตูุฏ ุฌุฏูุฏ ุงูุฑุงุฌุญู)

---

## ๏ฟฝ ุงูุฑุจุท ูุน Google Sheets / Google Sheets Integration

### ูููู ุงูุจูุงูุงุช / Data Structure

**1. Sheet: Account_Balances**
ูุญุชูู ุนูู:
```
| ุงูุญุณุงุจ | ุงูุฑุตูุฏ | ุขุฎุฑ ุชุญุฏูุซ |
|--------|--------|-----------|
| AlrajhiBank | 15000.00 | 2026-01-24 15:30:22 |
| Tiqmo | 5000.00 | 2026-01-24 14:20:15 |
```

**2. Sheet: Sheet1 (ุงููุนุงููุงุช)**
ูู ูุนุงููุฉ ุชุญุชูู ุนูู:
- UUID (ูุนุฑู ูุฑูุฏ)
- ุฑูู ุงูุญุณุงุจ (accNum)
- ุฑูู ุงูุจุทุงูุฉ (cardNum)
- ุงููุจูุบุ ุงูุฌูุฉุ ุงูุชุตูููุ ุงูููุน

**3. ุงูุฑุจุท ุงูุชููุงุฆู:**
- ุนูุฏ ุญูุธ ูุนุงููุฉ ูู Sheet1
- ูุชู ุงุณุชุฎุฑุงุฌ ุฑูู ุงูุญุณุงุจ (accNum ุฃู cardNum)
- ูุชู ุชุญุฏูุซ ุงูุฑุตูุฏ ูู Account_Balances
- ูุชู ุฅุฑุณุงู ุฅุดุนุงุฑ Telegram ุจุงูุฑุตูุฏ ุงูุฌุฏูุฏ

### ุชุญุฏูุฏ ุงูุญุณุงุจ / Account Identification

ูุชู ุชุญุฏูุฏ ุงูุญุณุงุจ ุจุฅุญุฏู ุงูุทุฑู:
1. **ูู ุฑูู ุงูุญุณุงุจ (accNum):** ูุซู "AlrajhiBank 9767"
2. **ูู ุฑูู ุงูุจุทุงูุฉ (cardNum):** ูุซู "4567"
3. **ูู ุงุณู ุงูุจูู ูู ุงูุฑุณุงูุฉ:** ุงุณุชุฎูุงุต ุชููุงุฆู ูู SMS

---

## ๐๏ธ ูููุทูุฑูู / For Developers

### ุงูุฏูุงู ุงููุชุงุญุฉ:

#### 1. `getAllBalances_()`
ุงูุญุตูู ุนูู ุฌููุน ุงูุฃุฑุตุฏุฉ
```javascript
var balances = getAllBalances_();
// Returns: [{account: 'AlrajhiBank', balance: 15000, lastUpdate: Date}, ...]
```

#### 2. `getBalance_(accountKey)`
ุงูุญุตูู ุนูู ุฑุตูุฏ ุญุณุงุจ ูุญุฏุฏ
```javascript
var balance = getBalance_('AlrajhiBank');
// Returns: 15000
```

#### 3. `setBalance_(accountKey, newBalance)`
ุชุนููู ุฑุตูุฏ ุญุณุงุจ
```javascript
setBalance_('AlrajhiBank', 15000);
```

#### 4. `applyTxnToBalance_(accountKey, amount, isIncoming)`
ุชุทุจูู ุนูููุฉ ุนูู ุงูุฑุตูุฏ
```javascript
// ุนูููุฉ ุตุงุฏุฑุฉ (ุดุฑุงุก)
applyTxnToBalance_('AlrajhiBank', 100, false);

// ุนูููุฉ ูุงุฑุฏุฉ (ุฅูุฏุงุน)
applyTxnToBalance_('AlrajhiBank', 5000, true);
```

#### 5. `sendAccountsBalanceReport_(chatId)`
ุฅุฑุณุงู ุชูุฑูุฑ ุงูุฃุฑุตุฏุฉ ููุชููุฌุฑุงู
```javascript
sendAccountsBalanceReport_(chatId);
```

#### 6. `determineAccountKey_(data)`
ุชุญุฏูุฏ ููุชุงุญ ุงูุญุณุงุจ ูู ุจูุงูุงุช ุงููุนุงููุฉ
```javascript
var accountKey = determineAccountKey_({
  accNum: 'AlrajhiBank 9767',
  cardNum: '4567',
  merchant: 'ุฌุฑูุฑ'
});
// Returns: 'AlrajhiBank 9767'
```

#### 7. `sendBalanceUpdateNotification_(accountKey, newBalance, txnData, isInternal)`
ุฅุฑุณุงู ุฅุดุนุงุฑ ุชุญุฏูุซ ุงูุฑุตูุฏ ุจุนุฏ ูู ุนูููุฉ
```javascript
sendBalanceUpdateNotification_('AlrajhiBank', 14850, {
  amount: 150,
  merchant: 'ุฌุฑูุฑ',
  type: 'ูุดุชุฑูุงุช',
  isIncoming: false
}, false);
```

---

## ๐ ุงููููุงุช ุงููุนุฏููุฉ / Modified Files

1. **Balances.js**
   - ุฃุถููุช ุฏุงูุฉ `getAllBalances_()` ูุฌูุจ ุฌููุน ุงูุฃุฑุตุฏุฉ

2. **Telegram.js**
   - ุฃุถููุช ุฏุงูุฉ `sendAccountsBalanceReport_()` ูุฅุฑุณุงู ุงูุชูุฑูุฑ
   - ุชุญุฏูุซ ููุญุฉ ุงูุชุญูู ูุชุถููู ุฒุฑ "ุฑุตุฏ ูุงูู"

3. **Ingress.js**
   - ุฅุถุงูุฉ ูุนุงูุฌ ููุฃูุฑ `/balances` ู `ุฑุตุฏ ูุงูู`
   - ุฅุถุงูุฉ ูุนุงูุฌ ูุฒุฑ "ุฑุตุฏ ูุงูู" ูู ููุญุฉ ุงูุชุญูู

4. **Telegram_Commands.js**
   - ุฅุถุงูุฉ ุฃูุฑ `balances` ููุงุฆูุฉ ุฃูุงูุฑ ุงูุจูุช

5. **Flow.js** โญ (ุงูุชุญุฏูุซ ุงูุฃูู)
   - ุชุญุฏูุซ `syncQuadV120()` ูุชุญุฏูุซ ุงูุฃุฑุตุฏุฉ ุจุนุฏ ูู ูุนุงููุฉ
   - ุฅุถุงูุฉ `determineAccountKey_()` ูุชุญุฏูุฏ ุงูุญุณุงุจ ูู ุงูุจูุงูุงุช
   - ุฅุถุงูุฉ `sendBalanceUpdateNotification_()` ูุฅุฑุณุงู ุงูุฅุดุนุงุฑุงุช

6. **TEST_BALANCES.js** (ุฌุฏูุฏ)
   - ููู ุงุฎุชุจุงุฑ ููุชุฃูุฏ ูู ุนูู ุงูููุฒุฉ

---

## โ ุงุฎุชุจุงุฑ ุงูููุฒุฉ / Testing

ูุงุฎุชุจุงุฑ ุงูููุฒุฉ:

1. ุงูุชุญ Google Apps Script Editor
2. ุดุบูู ุฏุงูุฉ `TEST_BALANCES()`
3. ุชุญูู ูู ุงูููุฌ
4. ุฌุฑุจ ุงูุฃูุฑ ูู ุงูุชููุฌุฑุงู

ููุชุญูู ูู ุงูุฃุฑุตุฏุฉ ุงูุญุงููุฉ ููุท:
```javascript
SHOW_CURRENT_BALANCES()
```

---

## ๐ ููุงุญุธุงุช ูููุฉ / Important Notes

1. **ุงูุฃุฑุตุฏุฉ ุชูุฏูุฑูุฉ**: 
   - ุงูุฃุฑุตุฏุฉ ูุญุณูุจุฉ ุจูุงุกู ุนูู ุงูุนูููุงุช ุงููุณุฌูุฉ ููุท
   - ูุฏ ูุง ุชุทุงุจู ุงูุฑุตูุฏ ุงููุนูู ูู ุงูุจูู

2. **ุงูุฑุตูุฏ ุงูุฃููู**:
   - ุงุญุชุงุฌ ูุชุนููู ุงูุฑุตูุฏ ุงูุฃููู ูุฏููุงู:
   ```javascript
   setBalance_('AlrajhiBank', 15000);
   setBalance_('Tiqmo', 5000);
   ```

3. **ุงูุชุญุฏูุซ ุงูุชููุงุฆู**:
   - ุงูุฃุฑุตุฏุฉ ุชุชุญุฏุซ ุชููุงุฆูุงู ุนูุฏ ูุนุงูุฌุฉ ุฑุณุงุฆู SMS
   - ุงูุชุญูููุงุช ุจูู ุงูุญุณุงุจุงุช ุชุญุฏุซ ุงูุฑุตูุฏูู

---

## ๐ฏ ุฃูุซูุฉ ุงูุงุณุชุฎุฏุงู / Usage Examples

### ูุซุงู 1: ุฑุตูุฏ ุดูุฑู ุซุงุจุช
```
ุงูุฑุงุชุจ ููุฒู 27 ูู ุดูุฑ = 15000 ุฑูุงู
ุงูุฑุตูุฏ ุงูุงุจุชุฏุงุฆู: 15000
```

### ูุซุงู 2: ุจุนุฏ ุนูููุฉ ุดุฑุงุก
```
ูุจู: AlrajhiBank = 15000
ุนูููุฉ: ุดุฑุงุก ุจู 500 ุฑูุงู
ุจุนุฏ: AlrajhiBank = 14500
```

### ูุซุงู 3: ุชุญููู ุจูู ุญุณุงุจุงุช
```
ูุจู: 
- AlrajhiBank = 15000
- Tiqmo = 1000

ุนูููุฉ: ุชุญููู 4000 ูู ุงูุฑุงุฌุญู ุฅูู ุชููู

ุจุนุฏ:
- AlrajhiBank = 11000
- Tiqmo = 5000
```

---

## ๐ ุงูุชุญุฏูุซุงุช ุงููุณุชูุจููุฉ / Future Updates

ูููู ุฅุถุงูุฉ:
- โจ ุชูุจููุงุช ุนูุฏ ุงูุฎูุงุถ ุงูุฑุตูุฏ
- ๐ ุฑุณู ุจูุงูู ูุชุทูุฑ ุงูุฑุตูุฏ
- ๐ฑ ุฏุนู ุนููุงุช ูุชุนุฏุฏุฉ
- ๐ ูุฒุงููุฉ ูุน ุงูุจููู (API)
- ๐ ุชูุงุฑูุฑ ุดูุฑูุฉ ุชููุงุฆูุฉ

---

## ๐ ุงููุณุงุนุฏุฉ / Support

ุฅุฐุง ูุงุฌูุช ูุดุงูู:
1. ุชุฃูุฏ ูู ุชุญุฏูุซ Telegram bot commands: `SOV1_setMyCommands_()`
2. ุชุญูู ูู ุฃู Sheet "Account_Balances" ููุฌูุฏ
3. ุดุบู `TEST_BALANCES()` ููุชุฃูุฏ ูู ุนูู ุงูุฏูุงู

---

**ุชุงุฑูุฎ ุงูุฅุถุงูุฉ:** 24 ููุงูุฑ 2026  
**ุงูุฅุตุฏุงุฑ:** 1.0
